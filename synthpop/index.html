<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>synthpop - Tripsender Documentation</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../assets/_mkdocstrings.css" rel="stylesheet">
        <link href="../stylesheets/extra.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Tripsender Documentation</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href=".." class="nav-link">Welcome to tripsender</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">API Documentation</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../activity/" class="dropdown-item">activity</a>
</li>
                                    
<li>
    <a href="../building/" class="dropdown-item">building</a>
</li>
                                    
<li>
    <a href="../house/" class="dropdown-item">house</a>
</li>
                                    
<li>
    <a href="../household/" class="dropdown-item">household</a>
</li>
                                    
<li>
    <a href="../io/" class="dropdown-item">io</a>
</li>
                                    
<li>
    <a href="../location_assignment/" class="dropdown-item">location_assignment</a>
</li>
                                    
<li>
    <a href="../nhts/" class="dropdown-item">nhts</a>
</li>
                                    
<li>
    <a href="../od/" class="dropdown-item">od</a>
</li>
                                    
<li>
    <a href="../person/" class="dropdown-item">person</a>
</li>
                                    
<li>
    <a href="../population/" class="dropdown-item">population</a>
</li>
                                    
<li>
    <a href="../routing/" class="dropdown-item">routing</a>
</li>
                                    
<li>
    <a href="../sampler/" class="dropdown-item">sampler</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">synthpop</a>
</li>
                                    
<li>
    <a href="../utils/" class="dropdown-item">utils</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../sampler/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../utils/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.synthpop" class="nav-link">synthpop</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.synthpop.generate_persons" class="nav-link">generate_persons</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.synthpop.synthesise_population" class="nav-link">synthesise_population</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<div class="doc doc-object doc-module">



<a id="tripsender.synthpop"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="tripsender.synthpop.generate_persons" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_persons</span><span class="p">(</span><span class="n">population</span><span class="p">,</span> <span class="n">num_persons</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Generate individual person objects based on the given population data.</p>
<p>This function generates a number of Person instances based on the demographic distribution
provided in the population data. It uses the age, household type, and sex categories to
proportionally create individuals that reflect the overall population structure.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>population</code></td>
            <td>
                  <code>Population</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An instance of the Population class that contains demographic data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>num_persons</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of persons to generate. If not specified, the function
                          uses the total population size provided in the population data.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>The function performs the following steps:
1. If num_persons is specified, it uses that number; otherwise, it defaults to the total population size.
2. It clears any existing Person instances to start fresh.
3. It calculates the proportional distribution of individuals across different categories of age,
   household type, and sex based on the provided population data.
4. It iterates through the categories, creating the appropriate number of Person instances for each
   category, and assigns them to the respective age, household type, and sex.</p>


<details class="example-usage" open>
  <summary>Example usage</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>population_data = Population(year=2023, area="Haga")
generate_persons(population_data)</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>tripsender\synthpop.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_persons</span><span class="p">(</span><span class="n">population</span><span class="p">,</span> <span class="n">num_persons</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate individual person objects based on the given population data.</span>

<span class="sd">    This function generates a number of Person instances based on the demographic distribution</span>
<span class="sd">    provided in the population data. It uses the age, household type, and sex categories to</span>
<span class="sd">    proportionally create individuals that reflect the overall population structure.</span>

<span class="sd">    Args:</span>
<span class="sd">        population (Population): An instance of the Population class that contains demographic data.</span>
<span class="sd">        num_persons (int, optional): The number of persons to generate. If not specified, the function</span>
<span class="sd">                                      uses the total population size provided in the population data.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    The function performs the following steps:</span>
<span class="sd">    1. If num_persons is specified, it uses that number; otherwise, it defaults to the total population size.</span>
<span class="sd">    2. It clears any existing Person instances to start fresh.</span>
<span class="sd">    3. It calculates the proportional distribution of individuals across different categories of age,</span>
<span class="sd">       household type, and sex based on the provided population data.</span>
<span class="sd">    4. It iterates through the categories, creating the appropriate number of Person instances for each</span>
<span class="sd">       category, and assigns them to the respective age, household type, and sex.</span>

<span class="sd">    Example usage:</span>
<span class="sd">        &gt;&gt;&gt; population_data = Population(year=2023, area=&quot;Haga&quot;)</span>
<span class="sd">        &gt;&gt;&gt; generate_persons(population_data)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">num_persons</span><span class="p">:</span>
        <span class="c1"># If num_persons is specified, use that number</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of persons: </span><span class="si">{</span><span class="n">num_persons</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1">#TODO Not implemented</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Otherwise, use the total population</span>
        <span class="n">num_persons</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">total_population</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of persons: </span><span class="si">{</span><span class="n">num_persons</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">pop_distribution</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">array_age_household_sex</span><span class="o">/</span><span class="n">population</span><span class="o">.</span><span class="n">total_population</span>
    <span class="n">household_labels</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">variable_categories</span><span class="p">[</span><span class="s1">&#39;Hushållsställning&#39;</span><span class="p">]</span>
    <span class="n">age_labels</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">variable_categories</span><span class="p">[</span><span class="s1">&#39;Ålder&#39;</span><span class="p">]</span>
    <span class="n">sex_labels</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">variable_categories</span><span class="p">[</span><span class="s1">&#39;Kön&#39;</span><span class="p">]</span>

    <span class="c1"># Clear the instances of Person</span>
    <span class="n">Person</span><span class="o">.</span><span class="n">clear_instances</span><span class="p">()</span>

    <span class="c1"># Generating persons based on the population distribution</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">age</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">age_labels</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">household</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">household_labels</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">sex</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sex_labels</span><span class="p">):</span>
                <span class="n">person_range</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pop_distribution</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="n">num_persons</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">person_range</span><span class="p">):</span>
                    <span class="n">Person</span><span class="p">(</span><span class="n">age</span><span class="p">,</span> <span class="n">sex</span><span class="p">,</span> <span class="n">household</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.synthpop.synthesise_population" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">synthesise_population</span><span class="p">(</span><span class="n">population</span><span class="p">,</span> <span class="n">age_split</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">min_age_of_parent</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Synthesise a population by creating households and assigning attributes to individuals and households.</p>
<p>This function creates and assigns households, assigns children to households, and sets various
attributes such as house type and car ownership for the generated population. The process involves
multiple steps to ensure that the synthesized population accurately reflects real-world demographic
patterns and household structures.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>population</code></td>
            <td>
                  <code>Population</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An instance of the Population class containing demographic data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>age_split</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The age threshold used to categorize children into different age groups.
                       Defaults to 45.</p>
              </div>
            </td>
            <td>
                  <code>45</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>min_age_of_parent</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The minimum age for an individual to be considered a parent.
                               Defaults to 25.</p>
              </div>
            </td>
            <td>
                  <code>25</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>The function performs the following steps:
1. Retrieves the total number of households for the specified year and area.
2. Clears any existing Household instances to start fresh.
3. Splits individuals into different lists based on their household type categories (e.g., children,
   single parents, living alone, married, cohabiting, others).
4. Sorts the lists to prioritize older individuals for certain categories.
5. Creates households for individuals living alone and single parents.
6. Creates households for married and cohabiting couples.
7. Assigns remaining individuals to 'Other' category households.
8. Assigns children to appropriate households based on their age and household type.
9. Assigns house types to households based on the specified year and area.
10. Assigns car ownership to households using a pre-trained classifier model.
11. Assigns primary status (e.g., studying, working, inactive) to individuals using a pre-trained classifier model.</p>


<details class="example-usage" open>
  <summary>Example usage</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>population_data = Population(year=2023, area="Haga")
synthesise_population(population_data)</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>tripsender\synthpop.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">synthesise_population</span><span class="p">(</span><span class="n">population</span><span class="p">,</span> <span class="n">age_split</span> <span class="o">=</span> <span class="mi">45</span><span class="p">,</span> <span class="n">min_age_of_parent</span> <span class="o">=</span> <span class="mi">25</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Synthesise a population by creating households and assigning attributes to individuals and households.</span>

<span class="sd">    This function creates and assigns households, assigns children to households, and sets various</span>
<span class="sd">    attributes such as house type and car ownership for the generated population. The process involves</span>
<span class="sd">    multiple steps to ensure that the synthesized population accurately reflects real-world demographic</span>
<span class="sd">    patterns and household structures.</span>

<span class="sd">    Args:</span>
<span class="sd">        population (Population): An instance of the Population class containing demographic data.</span>
<span class="sd">        age_split (int, optional): The age threshold used to categorize children into different age groups.</span>
<span class="sd">                                   Defaults to 45.</span>
<span class="sd">        min_age_of_parent (int, optional): The minimum age for an individual to be considered a parent.</span>
<span class="sd">                                           Defaults to 25.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    The function performs the following steps:</span>
<span class="sd">    1. Retrieves the total number of households for the specified year and area.</span>
<span class="sd">    2. Clears any existing Household instances to start fresh.</span>
<span class="sd">    3. Splits individuals into different lists based on their household type categories (e.g., children,</span>
<span class="sd">       single parents, living alone, married, cohabiting, others).</span>
<span class="sd">    4. Sorts the lists to prioritize older individuals for certain categories.</span>
<span class="sd">    5. Creates households for individuals living alone and single parents.</span>
<span class="sd">    6. Creates households for married and cohabiting couples.</span>
<span class="sd">    7. Assigns remaining individuals to &#39;Other&#39; category households.</span>
<span class="sd">    8. Assigns children to appropriate households based on their age and household type.</span>
<span class="sd">    9. Assigns house types to households based on the specified year and area.</span>
<span class="sd">    10. Assigns car ownership to households using a pre-trained classifier model.</span>
<span class="sd">    11. Assigns primary status (e.g., studying, working, inactive) to individuals using a pre-trained classifier model.</span>

<span class="sd">    Example usage:</span>
<span class="sd">        &gt;&gt;&gt; population_data = Population(year=2023, area=&quot;Haga&quot;)</span>
<span class="sd">        &gt;&gt;&gt; synthesise_population(population_data)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get total households</span>
    <span class="n">year</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">year</span>
    <span class="n">area</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">area</span>
    <span class="n">total_households</span> <span class="o">=</span> <span class="n">tsutils</span><span class="o">.</span><span class="n">fetch_total_households</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">area</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total households: </span><span class="si">{</span><span class="n">total_households</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Split individuals into different lists based on their category</span>
    <span class="n">children</span><span class="p">,</span> <span class="n">single_parents</span><span class="p">,</span> <span class="n">living_alone</span><span class="p">,</span> <span class="n">married_males</span><span class="p">,</span> <span class="n">married_females</span><span class="p">,</span> <span class="n">cohabiting_males</span><span class="p">,</span> <span class="n">cohabiting_females</span><span class="p">,</span> <span class="n">others</span> <span class="o">=</span> <span class="n">tsutils</span><span class="o">.</span><span class="n">split_households_by_householdtype</span><span class="p">()</span>

    <span class="c1"># # Print counts and totals</span>
    <span class="c1"># logger.info(f&quot;Children: {len(children)}&quot;)</span>
    <span class="c1"># logger.info(f&quot;Single Parents: {len(single_parents)}&quot;)</span>
    <span class="c1"># logger.info(f&quot;Living Alone: {len(living_alone)}&quot;)</span>
    <span class="c1"># logger.info(f&quot;Married Male: {len(married_males)}&quot;)</span>
    <span class="c1"># logger.info(f&quot;Married Female: {len(married_females)}&quot;)</span>
    <span class="c1"># logger.info(f&quot;Cohabiting Male: {len(cohabiting_males)}&quot;)</span>
    <span class="c1"># logger.info(f&quot;Cohabiting Female: {len(cohabiting_females)}&quot;)</span>
    <span class="c1"># logger.info(f&quot;Others: {len(others)}&quot;)</span>

    <span class="c1"># logger.info(f&quot;Total: {len(children)+len(single_parents)+len(living_alone)+len(married_males)+len(married_females)+len(cohabiting_males)+len(cohabiting_females)+len(others)}&quot;)</span>

    <span class="c1"># Sort children by age</span>
    <span class="c1"># Trying reverse to prioritize older parents first</span>
    <span class="n">children</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">age</span><span class="p">,</span> <span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Sort single parents by age</span>
    <span class="n">single_parents</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">age</span><span class="p">,</span> <span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

    <span class="n">Household</span><span class="o">.</span><span class="n">clear_instances</span><span class="p">()</span>
    <span class="n">households</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Step 1 - Create Households</span>
    <span class="c1"># Living alone -&gt; Single</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total households after living alone: ie </span><span class="si">{</span><span class="n">total_households</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">living_alone</span><span class="p">)</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">total_households</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">living_alone</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">living_alone</span><span class="p">:</span>
        <span class="n">household</span> <span class="o">=</span> <span class="n">Household</span><span class="p">(</span><span class="s1">&#39;Single&#39;</span><span class="p">)</span>
        <span class="n">household</span><span class="o">.</span><span class="n">add_member</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
        <span class="n">households</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">household</span><span class="p">)</span>
    <span class="n">total_households</span> <span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="n">living_alone</span><span class="p">)</span>


    <span class="c1"># Single parents -&gt; Single</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total households after single parents: ie </span><span class="si">{</span><span class="n">total_households</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">single_parents</span><span class="p">)</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">total_households</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">single_parents</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">single_parents</span><span class="p">:</span>
        <span class="n">household</span> <span class="o">=</span> <span class="n">Household</span><span class="p">(</span><span class="s1">&#39;Single&#39;</span><span class="p">)</span>
        <span class="n">household</span><span class="o">.</span><span class="n">add_member</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
        <span class="n">household</span><span class="o">.</span><span class="n">has_children</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">households</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">household</span><span class="p">)</span>
    <span class="n">total_households</span> <span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="n">single_parents</span><span class="p">)</span>


    <span class="c1"># Married Couple / Cohabiting -&gt; Couple</span>

    <span class="n">len_couple_households</span><span class="p">,</span><span class="n">couple_households</span> <span class="o">=</span> <span class="n">tsutils</span><span class="o">.</span><span class="n">couples_from_individuals</span><span class="p">(</span><span class="n">married_males</span><span class="o">+</span><span class="n">cohabiting_males</span><span class="p">,</span><span class="n">married_females</span><span class="o">+</span><span class="n">cohabiting_females</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Len of couple households: </span><span class="si">{</span><span class="n">len_couple_households</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Actual len of couple households: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">couple_households</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">households</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">couple_households</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total households after couples: ie </span><span class="si">{</span><span class="n">total_households</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">len_couple_households</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">total_households</span><span class="o">-</span><span class="n">len_couple_households</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">total_households</span> <span class="o">-=</span> <span class="n">len_couple_households</span>


    <span class="c1"># Other -&gt; Other</span>
    <span class="c1"># Currently being undercounted</span>
    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">others</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">others</span><span class="p">:</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">others</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">household</span> <span class="o">=</span> <span class="n">Household</span><span class="p">(</span><span class="s1">&#39;Other&#39;</span><span class="p">)</span>
        <span class="n">household</span><span class="o">.</span><span class="n">add_member</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
        <span class="n">households</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">household</span><span class="p">)</span>
        <span class="n">total_households</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total households after others: ie </span><span class="si">{</span><span class="n">total_households</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">others</span><span class="p">)</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">total_households</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">others</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">other_households</span> <span class="o">=</span> <span class="p">[</span><span class="n">household</span> <span class="k">for</span> <span class="n">household</span> <span class="ow">in</span> <span class="n">households</span> <span class="k">if</span> <span class="n">household</span><span class="o">.</span><span class="n">category</span> <span class="o">==</span> <span class="s1">&#39;Other&#39;</span><span class="p">]</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total other households: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">other_households</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">others</span> <span class="ow">and</span> <span class="n">other_households</span><span class="p">:</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">others</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">household</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">other_households</span><span class="p">)</span>
        <span class="n">household</span><span class="o">.</span><span class="n">add_member</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>

    <span class="c1"># Step 2 - Assigning Children</span>
    <span class="n">tsutils</span><span class="o">.</span><span class="n">assign_children_to_households</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">area</span><span class="p">,</span> <span class="n">children</span><span class="p">,</span><span class="n">age_split</span><span class="p">)</span>
    <span class="n">Household</span><span class="o">.</span><span class="n">sync_children_in_households</span><span class="p">()</span>
    <span class="c1"># Step 3 - Assigning a housetype to the households</span>
    <span class="n">tsutils</span><span class="o">.</span><span class="n">assign_house_type_to_households</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">area</span><span class="p">)</span>

    <span class="c1"># Step 4 - Assigning car ownership to households</span>
    <span class="n">car_classifier</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;models/NHTS_CAR_OWNERSHIP_CLASSIFIER.joblib&#39;</span><span class="p">)</span>
    <span class="n">tsutils</span><span class="o">.</span><span class="n">assign_cars_to_households</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">area</span><span class="p">,</span> <span class="n">car_classifier</span><span class="p">)</span>

    <span class="c1"># Step 5 - Assigning primary status to persons</span>
    <span class="n">primary_status_classifier</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;models/NHTS_PRIMARY_STATUS_CLASSIFIER.joblib&#39;</span><span class="p">)</span>
    <span class="n">tsutils</span><span class="o">.</span><span class="n">assign_primary_status_to_members</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">area</span><span class="p">,</span><span class="n">primary_status_classifier</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
