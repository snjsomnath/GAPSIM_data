<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>od - Tripsender Documentation</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../assets/_mkdocstrings.css" rel="stylesheet">
        <link href="../stylesheets/extra.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Tripsender Documentation</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href=".." class="nav-link">Welcome to tripsender</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">API Documentation</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../activity/" class="dropdown-item">activity</a>
</li>
                                    
<li>
    <a href="../building/" class="dropdown-item">building</a>
</li>
                                    
<li>
    <a href="../house/" class="dropdown-item">house</a>
</li>
                                    
<li>
    <a href="../household/" class="dropdown-item">household</a>
</li>
                                    
<li>
    <a href="../io/" class="dropdown-item">io</a>
</li>
                                    
<li>
    <a href="../location_assignment/" class="dropdown-item">location_assignment</a>
</li>
                                    
<li>
    <a href="../nhts/" class="dropdown-item">nhts</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">od</a>
</li>
                                    
<li>
    <a href="../person/" class="dropdown-item">person</a>
</li>
                                    
<li>
    <a href="../population/" class="dropdown-item">population</a>
</li>
                                    
<li>
    <a href="../routing/" class="dropdown-item">routing</a>
</li>
                                    
<li>
    <a href="../sampler/" class="dropdown-item">sampler</a>
</li>
                                    
<li>
    <a href="../synthpop/" class="dropdown-item">synthpop</a>
</li>
                                    
<li>
    <a href="../utils/" class="dropdown-item">utils</a>
</li>
                                    
<li>
    <a href="../validation/" class="dropdown-item">validation</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../nhts/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../person/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.od" class="nav-link">od</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.od.ODMatrix" class="nav-link">ODMatrix</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.od.assign_households_to_buildings" class="nav-link">assign_households_to_buildings</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.od.assign_to_multi_family_buildings" class="nav-link">assign_to_multi_family_buildings</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.od.assign_to_single_family_buildings" class="nav-link">assign_to_single_family_buildings</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.od.create_location_mapping" class="nav-link">create_location_mapping</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.od.generate_od_matrix" class="nav-link">generate_od_matrix</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.od.get_gdf" class="nav-link">get_gdf</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.od.get_landuse" class="nav-link">get_landuse</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.od.get_pg_query" class="nav-link">get_pg_query</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.od.get_pgcon" class="nav-link">get_pgcon</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.od.get_road" class="nav-link">get_road</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.od.mark_empty_buildings" class="nav-link">mark_empty_buildings</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.od.process_residential_buildings" class="nav-link">process_residential_buildings</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.od.sort_buildings_by_type_and_population" class="nav-link">sort_buildings_by_type_and_population</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.od.sort_households_by_type_and_count" class="nav-link">sort_households_by_type_and_count</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<div class="doc doc-object doc-module">



<a id="tripsender.od"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="tripsender.od.ODMatrix" class="doc doc-heading">
            <code>ODMatrix</code>


</h2>


    <div class="doc doc-contents ">


              <details class="quote">
                <summary>Source code in <code>tripsender\od.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ODMatrix</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df_matrix</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matrix</span> <span class="o">=</span> <span class="n">df_matrix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activity_sequences</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">compute_routes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">nrc_drive</span><span class="p">,</span><span class="n">nrc_bike</span><span class="p">,</span><span class="n">nrc_walk</span><span class="p">,</span><span class="n">nrc_transit</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function computes the routes and durations for the OD matrix based on the mode of transport.</span>
<span class="sd">        The function iterates over the rows of the OD matrix and computes the route and duration based on the mode of transport.</span>
<span class="sd">        It user the NetworkRoutingComputer objects for each mode of transport to compute the route and duration.</span>

<span class="sd">        :param nrc_drive: (NetworkRoutingComputer) A NetworkRoutingComputer object for driving</span>
<span class="sd">        :param nrc_bike: (NetworkRoutingComputer) A NetworkRoutingComputer object for biking</span>
<span class="sd">        :param nrc_walk: (NetworkRoutingComputer) A NetworkRoutingComputer object for walking</span>
<span class="sd">        :param nrc_transit: (NetworkRoutingComputer) A NetworkRoutingComputer object for transit</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span>
            <span class="n">origin</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span>
            <span class="n">destination</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">]</span>
            <span class="n">activity_sequence</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;activity_sequence&#39;</span><span class="p">]</span>
            <span class="n">transit_activity</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;transit_activity&#39;</span><span class="p">]</span>
            <span class="c1"># Initialize route and duration variables</span>
            <span class="n">route</span><span class="p">,</span> <span class="n">duration</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
            <span class="c1"># Compute route and duration based on the mode</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Car&#39;</span><span class="p">,</span> <span class="s1">&#39;Taxi&#39;</span><span class="p">,</span> <span class="s1">&#39;Moped&#39;</span><span class="p">,</span> <span class="s1">&#39;Other&#39;</span><span class="p">,</span> <span class="s1">&#39;Transportation service&#39;</span><span class="p">,</span> <span class="s1">&#39;Flight&#39;</span><span class="p">]:</span>
                <span class="n">route</span><span class="p">,</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">nrc_drive</span><span class="o">.</span><span class="n">compute_route</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span>
                <span class="c1">#route = &quot;This came from drive&quot;</span>
                <span class="c1">#print(&quot;Route:&quot;, route) </span>
            <span class="k">elif</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Bicycle/E-bike&quot;</span><span class="p">]:</span>
                <span class="n">route</span><span class="p">,</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">nrc_bike</span><span class="o">.</span><span class="n">compute_route</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span>
                <span class="c1">#route = &quot;This came from bike&quot;</span>
                <span class="c1">#print(&quot;Route:&quot;, route) </span>
            <span class="k">elif</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Walking&#39;</span><span class="p">]:</span>
                <span class="n">route</span><span class="p">,</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">nrc_walk</span><span class="o">.</span><span class="n">compute_route</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span>
                <span class="c1">#route = &quot;This came from walk&quot;</span>
                <span class="c1">#print(&quot;Route:&quot;, route) </span>
            <span class="k">elif</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Train/Tram&#39;</span><span class="p">,</span> <span class="s1">&#39;Bus&#39;</span><span class="p">,</span> <span class="s1">&#39;Boat&#39;</span><span class="p">]:</span>
                <span class="n">route</span><span class="p">,</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">nrc_transit</span><span class="o">.</span><span class="n">compute_route</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span>
                <span class="c1">#route = &quot;This came from transit&quot;</span>
                <span class="c1">#print(&quot;Route:&quot;, route)  </span>

            <span class="c1"># Here if the route and duration is None it is because either the origin or destination is same</span>
            <span class="c1"># or the purpose was travel and there is no specific location for travel</span>
            <span class="c1"># In such cases, we will assign the origin and destination as the route and duration as 0</span>

            <span class="n">transit_activity</span><span class="o">.</span><span class="n">route</span> <span class="o">=</span> <span class="n">route</span>
            <span class="n">transit_activity</span><span class="o">.</span><span class="n">calculated_duration</span> <span class="o">=</span> <span class="n">duration</span>
            <span class="n">transit_activity</span><span class="o">.</span><span class="n">origin_coordinates</span> <span class="o">=</span> <span class="n">origin</span>
            <span class="n">transit_activity</span><span class="o">.</span><span class="n">destination_coordinates</span> <span class="o">=</span> <span class="n">destination</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tripsender.od.ODMatrix.compute_routes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_routes</span><span class="p">(</span><span class="n">nrc_drive</span><span class="p">,</span> <span class="n">nrc_bike</span><span class="p">,</span> <span class="n">nrc_walk</span><span class="p">,</span> <span class="n">nrc_transit</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>This function computes the routes and durations for the OD matrix based on the mode of transport.
The function iterates over the rows of the OD matrix and computes the route and duration based on the mode of transport.
It user the NetworkRoutingComputer objects for each mode of transport to compute the route and duration.</p>
<p>:param nrc_drive: (NetworkRoutingComputer) A NetworkRoutingComputer object for driving
:param nrc_bike: (NetworkRoutingComputer) A NetworkRoutingComputer object for biking
:param nrc_walk: (NetworkRoutingComputer) A NetworkRoutingComputer object for walking
:param nrc_transit: (NetworkRoutingComputer) A NetworkRoutingComputer object for transit</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\od.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compute_routes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">nrc_drive</span><span class="p">,</span><span class="n">nrc_bike</span><span class="p">,</span><span class="n">nrc_walk</span><span class="p">,</span><span class="n">nrc_transit</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function computes the routes and durations for the OD matrix based on the mode of transport.</span>
<span class="sd">    The function iterates over the rows of the OD matrix and computes the route and duration based on the mode of transport.</span>
<span class="sd">    It user the NetworkRoutingComputer objects for each mode of transport to compute the route and duration.</span>

<span class="sd">    :param nrc_drive: (NetworkRoutingComputer) A NetworkRoutingComputer object for driving</span>
<span class="sd">    :param nrc_bike: (NetworkRoutingComputer) A NetworkRoutingComputer object for biking</span>
<span class="sd">    :param nrc_walk: (NetworkRoutingComputer) A NetworkRoutingComputer object for walking</span>
<span class="sd">    :param nrc_transit: (NetworkRoutingComputer) A NetworkRoutingComputer object for transit</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span>
        <span class="n">origin</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span>
        <span class="n">destination</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">]</span>
        <span class="n">activity_sequence</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;activity_sequence&#39;</span><span class="p">]</span>
        <span class="n">transit_activity</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;transit_activity&#39;</span><span class="p">]</span>
        <span class="c1"># Initialize route and duration variables</span>
        <span class="n">route</span><span class="p">,</span> <span class="n">duration</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="c1"># Compute route and duration based on the mode</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Car&#39;</span><span class="p">,</span> <span class="s1">&#39;Taxi&#39;</span><span class="p">,</span> <span class="s1">&#39;Moped&#39;</span><span class="p">,</span> <span class="s1">&#39;Other&#39;</span><span class="p">,</span> <span class="s1">&#39;Transportation service&#39;</span><span class="p">,</span> <span class="s1">&#39;Flight&#39;</span><span class="p">]:</span>
            <span class="n">route</span><span class="p">,</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">nrc_drive</span><span class="o">.</span><span class="n">compute_route</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span>
            <span class="c1">#route = &quot;This came from drive&quot;</span>
            <span class="c1">#print(&quot;Route:&quot;, route) </span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Bicycle/E-bike&quot;</span><span class="p">]:</span>
            <span class="n">route</span><span class="p">,</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">nrc_bike</span><span class="o">.</span><span class="n">compute_route</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span>
            <span class="c1">#route = &quot;This came from bike&quot;</span>
            <span class="c1">#print(&quot;Route:&quot;, route) </span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Walking&#39;</span><span class="p">]:</span>
            <span class="n">route</span><span class="p">,</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">nrc_walk</span><span class="o">.</span><span class="n">compute_route</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span>
            <span class="c1">#route = &quot;This came from walk&quot;</span>
            <span class="c1">#print(&quot;Route:&quot;, route) </span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Train/Tram&#39;</span><span class="p">,</span> <span class="s1">&#39;Bus&#39;</span><span class="p">,</span> <span class="s1">&#39;Boat&#39;</span><span class="p">]:</span>
            <span class="n">route</span><span class="p">,</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">nrc_transit</span><span class="o">.</span><span class="n">compute_route</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span>
            <span class="c1">#route = &quot;This came from transit&quot;</span>
            <span class="c1">#print(&quot;Route:&quot;, route)  </span>

        <span class="c1"># Here if the route and duration is None it is because either the origin or destination is same</span>
        <span class="c1"># or the purpose was travel and there is no specific location for travel</span>
        <span class="c1"># In such cases, we will assign the origin and destination as the route and duration as 0</span>

        <span class="n">transit_activity</span><span class="o">.</span><span class="n">route</span> <span class="o">=</span> <span class="n">route</span>
        <span class="n">transit_activity</span><span class="o">.</span><span class="n">calculated_duration</span> <span class="o">=</span> <span class="n">duration</span>
        <span class="n">transit_activity</span><span class="o">.</span><span class="n">origin_coordinates</span> <span class="o">=</span> <span class="n">origin</span>
        <span class="n">transit_activity</span><span class="o">.</span><span class="n">destination_coordinates</span> <span class="o">=</span> <span class="n">destination</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="tripsender.od.assign_households_to_buildings" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">assign_households_to_buildings</span><span class="p">(</span><span class="n">gdf_residential</span><span class="p">,</span> <span class="n">area_per_person</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>This function assigns the households to the buildings based on the area_per_person parameter.</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\od.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">assign_households_to_buildings</span><span class="p">(</span><span class="n">gdf_residential</span><span class="p">,</span> <span class="n">area_per_person</span><span class="o">=</span><span class="mi">32</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function assigns the households to the buildings based on the area_per_person parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">House</span><span class="o">.</span><span class="n">clear_instances</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Processing residential buildings&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Fetching single and multi family housesholds&quot;</span><span class="p">)</span>
    <span class="n">households_in_single_family_house</span><span class="p">,</span> <span class="n">households_in_multi_family_house</span> <span class="o">=</span> <span class="n">sort_households_by_type_and_count</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Fetching single and multi family buildings&quot;</span><span class="p">)</span>
    <span class="n">single_family_buildings</span><span class="p">,</span> <span class="n">multi_family_buildings</span> <span class="o">=</span> <span class="n">sort_buildings_by_type_and_population</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of single family buildings: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">single_family_buildings</span><span class="p">)</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">households_in_single_family_house</span><span class="p">)</span><span class="si">}</span><span class="s2"> households&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of multi family buildings: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">multi_family_buildings</span><span class="p">)</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">households_in_multi_family_house</span><span class="p">)</span><span class="si">}</span><span class="s2"> households&quot;</span><span class="p">)</span>

    <span class="c1"># If no buildings are found in single and multi family houses, raise an error</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">single_family_buildings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">households_in_single_family_house</span><span class="p">)</span> <span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No buildings found in single family houses while there are households in single family houses&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">multi_family_buildings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">households_in_multi_family_house</span><span class="p">)</span> <span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No buildings found in multi family houses while there are households in multi family houses&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">single_family_buildings</span> <span class="ow">and</span> <span class="n">households_in_single_family_house</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Processing single family houses&quot;</span><span class="p">)</span>
        <span class="n">assign_to_single_family_buildings</span><span class="p">(</span><span class="n">households_in_single_family_house</span><span class="p">,</span> <span class="n">single_family_buildings</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">multi_family_buildings</span> <span class="ow">and</span> <span class="n">households_in_multi_family_house</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Processing multi family houses&quot;</span><span class="p">)</span>
        <span class="n">assign_to_multi_family_buildings</span><span class="p">(</span><span class="n">households_in_multi_family_house</span><span class="p">,</span> <span class="n">multi_family_buildings</span><span class="p">,</span> <span class="n">area_per_person</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Marking empty buildings&quot;</span><span class="p">)</span>

    <span class="c1"># Update the house_type at the person level to match the house_type at the Household level</span>
    <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">Person</span><span class="o">.</span><span class="n">instances</span><span class="p">:</span>
        <span class="n">person</span><span class="o">.</span><span class="n">house_type</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="n">household</span><span class="o">.</span><span class="n">house_type</span>
    <span class="n">mark_empty_buildings</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.od.assign_to_multi_family_buildings" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">assign_to_multi_family_buildings</span><span class="p">(</span><span class="n">households</span><span class="p">,</span> <span class="n">buildings</span><span class="p">,</span> <span class="n">area_per_person</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>This function assigns the households to multi family buildings.</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\od.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">assign_to_multi_family_buildings</span><span class="p">(</span><span class="n">households</span><span class="p">,</span> <span class="n">buildings</span><span class="p">,</span> <span class="n">area_per_person</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function assigns the households to multi family buildings.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">num_buildings</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">buildings</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">num_buildings</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;assign_to_multi_family_buildings: No buildings left to assign multi family households to&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">num_households</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">households</span><span class="p">)</span>
    <span class="n">cycles</span> <span class="o">=</span> <span class="n">num_households</span> <span class="o">//</span> <span class="n">num_buildings</span>
    <span class="n">remaining_households</span> <span class="o">=</span> <span class="n">num_households</span> <span class="o">%</span> <span class="n">num_buildings</span>

    <span class="k">for</span> <span class="n">cycle</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cycles</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">building</span> <span class="ow">in</span> <span class="n">buildings</span><span class="p">:</span>
            <span class="n">household</span> <span class="o">=</span> <span class="n">households</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">remaining_capacity</span> <span class="o">=</span> <span class="n">area_per_person</span> <span class="o">*</span> <span class="n">building</span><span class="o">.</span><span class="n">built_up_area</span> <span class="o">-</span> <span class="n">building</span><span class="o">.</span><span class="n">population_total</span>
            <span class="k">if</span> <span class="n">remaining_capacity</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">household</span><span class="o">.</span><span class="n">members</span><span class="p">):</span>
                <span class="n">house</span> <span class="o">=</span> <span class="n">House</span><span class="p">(</span><span class="n">household</span><span class="p">,</span> <span class="n">building</span><span class="p">)</span>
                <span class="n">remaining_capacity</span> <span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="n">household</span><span class="o">.</span><span class="n">members</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">households</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">household</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">remaining_households</span><span class="p">):</span>
        <span class="n">building</span> <span class="o">=</span> <span class="n">buildings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">household</span> <span class="o">=</span> <span class="n">households</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">remaining_capacity</span> <span class="o">=</span> <span class="n">area_per_person</span> <span class="o">*</span> <span class="n">building</span><span class="o">.</span><span class="n">built_up_area</span> <span class="o">-</span> <span class="n">building</span><span class="o">.</span><span class="n">population_total</span>
        <span class="k">if</span> <span class="n">remaining_capacity</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">household</span><span class="o">.</span><span class="n">members</span><span class="p">):</span>
            <span class="n">house</span> <span class="o">=</span> <span class="n">House</span><span class="p">(</span><span class="n">household</span><span class="p">,</span> <span class="n">building</span><span class="p">)</span>
            <span class="n">remaining_capacity</span> <span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="n">household</span><span class="o">.</span><span class="n">members</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">households</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">household</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.od.assign_to_single_family_buildings" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">assign_to_single_family_buildings</span><span class="p">(</span><span class="n">households</span><span class="p">,</span> <span class="n">buildings</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>This function assigns the households to single family buildings.</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\od.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">assign_to_single_family_buildings</span><span class="p">(</span><span class="n">households</span><span class="p">,</span> <span class="n">buildings</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function assigns the households to single family buildings.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">households</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">buildings</span><span class="p">):</span>
        <span class="c1"># If there are more buildings than households, assign one household to each building</span>
        <span class="c1"># Every building will have atleast 1 single family house</span>
        <span class="n">buildings</span> <span class="o">=</span> <span class="n">buildings</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">households</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">household</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">households</span><span class="p">):</span>
            <span class="n">building</span> <span class="o">=</span> <span class="n">buildings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">house</span> <span class="o">=</span> <span class="n">House</span><span class="p">(</span><span class="n">household</span><span class="p">,</span> <span class="n">building</span><span class="p">)</span>
            <span class="n">house</span><span class="o">.</span><span class="n">area</span> <span class="o">=</span> <span class="n">building</span><span class="o">.</span><span class="n">area</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;assign_to_single_family_buildings: Assgned </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">households</span><span class="p">)</span><span class="si">}</span><span class="s2"> single family households to </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">buildings</span><span class="p">)</span><span class="si">}</span><span class="s2"> buildings&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.od.create_location_mapping" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_location_mapping</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="n">random_location</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Helper function to create a mapping of activity purposes to locations.
It is possible to select random locations for each activity purpose by setting the random_location flag to True.
If random_location is False, the first location from the preferred locations is selected for each activity purpose.</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\od.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_location_mapping</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="n">random_location</span> <span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper function to create a mapping of activity purposes to locations.</span>
<span class="sd">    It is possible to select random locations for each activity purpose by setting the random_location flag to True.</span>
<span class="sd">    If random_location is False, the first location from the preferred locations is selected for each activity purpose.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">preferred_locations</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="n">household</span><span class="o">.</span><span class="n">house</span><span class="o">.</span><span class="n">building</span><span class="o">.</span><span class="n">preferred_locations</span>
    <span class="c1"># Location assignments</span>
    <span class="n">home_location</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="n">origin</span>
    <span class="n">work_location</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="n">work_location</span><span class="o">.</span><span class="n">location_coordinates</span> <span class="k">if</span> <span class="n">person</span><span class="o">.</span><span class="n">work_location</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="c1"># Selecting locations based on the random flag</span>
    <span class="k">if</span> <span class="n">random_location</span><span class="p">:</span>
        <span class="n">education_location</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">preferred_locations</span><span class="o">.</span><span class="n">EDUCATION</span><span class="p">)</span><span class="o">.</span><span class="n">location_coordinates</span>
        <span class="n">shopping_location</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">preferred_locations</span><span class="o">.</span><span class="n">SHOPPING_OTHER</span><span class="p">)</span><span class="o">.</span><span class="n">location_coordinates</span>
        <span class="n">shopping_groceries_location</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">preferred_locations</span><span class="o">.</span><span class="n">SHOPPING_GROCERY</span><span class="p">)</span><span class="o">.</span><span class="n">location_coordinates</span>
        <span class="n">leisure_location</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">preferred_locations</span><span class="o">.</span><span class="n">LEISURE</span><span class="p">)</span><span class="o">.</span><span class="n">location_coordinates</span>
        <span class="n">healthcare_location</span> <span class="o">=</span> <span class="n">preferred_locations</span><span class="o">.</span><span class="n">HEALTHCARE</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">location_coordinates</span>
        <span class="c1">#healthcare_location = random.choice(preferred_locations.HEALTHCARE).location_coordinates</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">education_location</span> <span class="o">=</span> <span class="n">preferred_locations</span><span class="o">.</span><span class="n">EDUCATION</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">location_coordinates</span>
        <span class="n">shopping_location</span> <span class="o">=</span> <span class="n">preferred_locations</span><span class="o">.</span><span class="n">SHOPPING_OTHER</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">location_coordinates</span>
        <span class="n">shopping_groceries_location</span> <span class="o">=</span> <span class="n">preferred_locations</span><span class="o">.</span><span class="n">SHOPPING_GROCERY</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">location_coordinates</span>
        <span class="n">leisure_location</span> <span class="o">=</span> <span class="n">preferred_locations</span><span class="o">.</span><span class="n">LEISURE</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">location_coordinates</span>
        <span class="n">healthcare_location</span> <span class="o">=</span> <span class="n">preferred_locations</span><span class="o">.</span><span class="n">HEALTHCARE</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">location_coordinates</span>

    <span class="c1"># Handling other random location which is common between random and non-random selection</span>
    <span class="n">other_location</span> <span class="o">=</span> <span class="n">preferred_locations</span><span class="o">.</span><span class="n">random_location</span><span class="p">()</span>
    <span class="n">travel_location</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="n">origin</span>  <span class="c1"># Assuming there&#39;s no specific location for &#39;Travel&#39;</span>
    <span class="n">children_location</span> <span class="o">=</span> <span class="n">preferred_locations</span><span class="o">.</span><span class="n">EDUCATION_frskola</span><span class="o">.</span><span class="n">location_coordinates</span>

    <span class="n">location_mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Home&quot;</span><span class="p">:</span> <span class="n">home_location</span><span class="p">,</span>
        <span class="s2">&quot;Work&quot;</span><span class="p">:</span> <span class="n">work_location</span><span class="p">,</span>
        <span class="s2">&quot;Education&quot;</span><span class="p">:</span> <span class="n">education_location</span><span class="p">,</span>
        <span class="s2">&quot;Shopping&quot;</span><span class="p">:</span> <span class="n">shopping_location</span><span class="p">,</span>
        <span class="s2">&quot;Grocery&quot;</span><span class="p">:</span> <span class="n">shopping_groceries_location</span><span class="p">,</span>
        <span class="s2">&quot;Leisure&quot;</span><span class="p">:</span> <span class="n">leisure_location</span><span class="p">,</span>
        <span class="s2">&quot;Other&quot;</span><span class="p">:</span> <span class="n">other_location</span><span class="p">,</span>
        <span class="s2">&quot;Healthcare&quot;</span><span class="p">:</span> <span class="n">healthcare_location</span><span class="p">,</span>
        <span class="s2">&quot;Travel&quot;</span><span class="p">:</span> <span class="n">travel_location</span><span class="p">,</span>
        <span class="s2">&quot;Pickup/Dropoff child&quot;</span><span class="p">:</span> <span class="n">children_location</span>
    <span class="p">}</span>
    <span class="n">person</span><span class="o">.</span><span class="n">location_mapping</span> <span class="o">=</span> <span class="n">location_mapping</span>
    <span class="k">return</span> <span class="n">location_mapping</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.od.generate_od_matrix" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_od_matrix</span><span class="p">(</span><span class="n">num_samples</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_location</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>This function generates an OD matrix based on the activity sequences of the persons.
The process of generating the OD matrix is as follows:
1 - Identify all the adults in the households
2 - For each adult, identify the activity sequence
3 - Get the location_mapping dictionary for the person
4 - For each activity, identify the origin, destination and mode of transport
    4.1 - First origin is the home location
    4.2 - Last destination is the home location
    4.3 - Mode of transport is the mode of transport for the activity
5 - Append the origin, destination, mode, person and activity sequence to the OD_pairs list
6 - Create a dataframe from the OD_pairs list
7 - Create an ODMatrix object from the dataframe
8 - Return the ODMatrix object</p>
<p>Some caveats:
- If the destination purpose is Travel, the destination is set to None. This is done by the create_location_mapping function</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\od.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_od_matrix</span><span class="p">(</span><span class="n">num_samples</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_location</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    This function generates an OD matrix based on the activity sequences of the persons.</span>
<span class="sd">    The process of generating the OD matrix is as follows:</span>
<span class="sd">    1 - Identify all the adults in the households</span>
<span class="sd">    2 - For each adult, identify the activity sequence</span>
<span class="sd">    3 - Get the location_mapping dictionary for the person</span>
<span class="sd">    4 - For each activity, identify the origin, destination and mode of transport</span>
<span class="sd">        4.1 - First origin is the home location</span>
<span class="sd">        4.2 - Last destination is the home location</span>
<span class="sd">        4.3 - Mode of transport is the mode of transport for the activity</span>
<span class="sd">    5 - Append the origin, destination, mode, person and activity sequence to the OD_pairs list</span>
<span class="sd">    6 - Create a dataframe from the OD_pairs list</span>
<span class="sd">    7 - Create an ODMatrix object from the dataframe</span>
<span class="sd">    8 - Return the ODMatrix object</span>

<span class="sd">    Some caveats:</span>
<span class="sd">    - If the destination purpose is Travel, the destination is set to None. This is done by the create_location_mapping function</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating OD Matrix...&quot;</span><span class="p">)</span> 
    <span class="n">activity_sequences</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">OD_pairs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">person_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">activity_sequence_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">num_samples</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">num_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">instances</span><span class="p">)</span>

    <span class="n">buildings</span> <span class="o">=</span> <span class="n">Building</span><span class="o">.</span><span class="n">instances</span>
    <span class="n">houses</span> <span class="o">=</span> <span class="p">[</span><span class="n">house</span> <span class="k">for</span> <span class="n">building</span> <span class="ow">in</span> <span class="n">buildings</span> <span class="k">for</span> <span class="n">house</span> <span class="ow">in</span> <span class="n">building</span><span class="o">.</span><span class="n">houses</span><span class="p">]</span>
    <span class="n">households</span> <span class="o">=</span> <span class="p">[</span><span class="n">house</span><span class="o">.</span><span class="n">household</span> <span class="k">for</span> <span class="n">house</span> <span class="ow">in</span> <span class="n">houses</span><span class="p">]</span>
    <span class="n">persons</span> <span class="o">=</span> <span class="p">[</span><span class="n">person</span> <span class="k">for</span> <span class="n">household</span> <span class="ow">in</span> <span class="n">households</span> <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">household</span><span class="o">.</span><span class="n">members</span><span class="p">]</span>
    <span class="n">adults</span> <span class="o">=</span> <span class="p">[</span><span class="n">person</span> <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">persons</span> <span class="k">if</span> <span class="n">person</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;=</span> <span class="mi">18</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">num_samples</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">adults</span><span class="p">:</span>
        <span class="n">activity_sequence</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="n">activity_sequence</span>
        <span class="n">activity_sequences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">activity_sequence</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">activity_sequence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">location_mapping</span> <span class="o">=</span> <span class="n">create_location_mapping</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="n">random_location</span> <span class="o">=</span> <span class="n">random_location</span><span class="p">)</span>
            <span class="n">activities</span> <span class="o">=</span> <span class="n">activity_sequence</span><span class="o">.</span><span class="n">activities</span>

            <span class="k">if</span> <span class="n">activities</span><span class="p">:</span>
                <span class="n">last_non_none_location</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="n">origin</span>  <span class="c1"># Initialize with home location</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">activities</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                    <span class="n">origin_activity</span> <span class="o">=</span> <span class="n">activities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">mode_activity</span> <span class="o">=</span> <span class="n">activities</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">destination_activity</span> <span class="o">=</span> <span class="n">activities</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">activities</span><span class="p">)</span> <span class="k">else</span> <span class="n">origin_activity</span>

                    <span class="c1"># Assigning locations</span>
                    <span class="n">origin</span> <span class="o">=</span> <span class="n">location_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">origin_activity</span><span class="o">.</span><span class="n">purpose</span><span class="p">,</span> <span class="n">last_non_none_location</span><span class="p">)</span>
                    <span class="n">destination</span> <span class="o">=</span> <span class="n">location_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">destination_activity</span><span class="o">.</span><span class="n">purpose</span><span class="p">)</span>

                    <span class="c1"># If destination is None due to &quot;Travel&quot;, keep last_non_none_location for next origin</span>
                    <span class="k">if</span> <span class="n">destination</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">last_non_none_location</span> <span class="o">=</span> <span class="n">destination</span>

                    <span class="n">mode</span> <span class="o">=</span> <span class="n">mode_activity</span><span class="o">.</span><span class="n">mode</span>

                    <span class="c1"># Append to OD pairs</span>
                    <span class="n">OD_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">origin</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">mode_activity</span><span class="p">,</span> <span class="n">origin_activity</span><span class="o">.</span><span class="n">purpose</span><span class="p">,</span> <span class="n">destination_activity</span><span class="o">.</span><span class="n">purpose</span><span class="p">])</span>
                    <span class="n">person_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
                    <span class="n">activity_sequence_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">activity_sequence</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">OD_pairs</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;mode&#39;</span><span class="p">,</span> <span class="s2">&quot;transit_activity&quot;</span> <span class="p">,</span><span class="s1">&#39;O_purpose&#39;</span><span class="p">,</span> <span class="s1">&#39;D_purpose&#39;</span><span class="p">])</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;person&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">person_list</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;activity_sequence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">activity_sequence_list</span>

    <span class="n">od_matrix</span> <span class="o">=</span> <span class="n">ODMatrix</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">od_matrix</span><span class="o">.</span><span class="n">activity_sequences</span> <span class="o">=</span> <span class="n">activity_sequences</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;OD Matrix successfully created...&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">od_matrix</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.od.get_gdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_gdf</span><span class="p">(</span><span class="n">area</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">KEY</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">VAL</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Data from Server&#39;</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">local</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">web</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>A function to fetch spatial geometry from the <code>PostGIS</code> server as <code>GeoPandas GeoDataFrame</code>.
This function is simply a wrapper for the <code>psycopg2</code> module.
It constructs an <code>SQL</code> query based on the the params provided and requests data from the server.</p>
<p>:param area: (str) The name of the Primary area in the Model naming format.
:param feature: (str) The feature name to select from the <code>PostGIS</code> database. (Refer to PostGIS naming convention)
:param KEY: (str: Optional) An optional attribute to filter from the data at the server level
:param VAL: (str: Optional) An optional value for a given key to match from the data at the server level
:param title: (str: Optional) An optional title for the plot
:param filter: (bool: Optional) An optional input to specify if the data must be filtered at the server level
:param local: (bool: Optional) Which server to fetch the data from
:param web: (bool: Optional) If <code>True</code>, the result will be reprojected
:param plot: (bool: Optional) If <code>True</code>, the result will be plotted
:return: (GeoPandas GeoDataFrame, plot(Optional)) The resulting <code>GeoPandas GeoDataFrame</code>.</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\od.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_gdf</span><span class="p">(</span><span class="n">area</span><span class="p">,</span>   <span class="c1">#TODO Fix area naming convention to match PXWEB naming</span>
            <span class="n">feature</span><span class="p">,</span>
            <span class="n">KEY</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="n">VAL</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Data from Server&#39;</span><span class="p">,</span>
            <span class="nb">filter</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">local</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">web</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A function to fetch spatial geometry from the ``PostGIS`` server as ``GeoPandas GeoDataFrame``.</span>
<span class="sd">    This function is simply a wrapper for the ``psycopg2`` module.</span>
<span class="sd">    It constructs an ``SQL`` query based on the the params provided and requests data from the server.</span>

<span class="sd">    :param area: (str) The name of the Primary area in the Model naming format.</span>
<span class="sd">    :param feature: (str) The feature name to select from the ``PostGIS`` database. (Refer to PostGIS naming convention)</span>
<span class="sd">    :param KEY: (str: Optional) An optional attribute to filter from the data at the server level</span>
<span class="sd">    :param VAL: (str: Optional) An optional value for a given key to match from the data at the server level</span>
<span class="sd">    :param title: (str: Optional) An optional title for the plot</span>
<span class="sd">    :param filter: (bool: Optional) An optional input to specify if the data must be filtered at the server level</span>
<span class="sd">    :param local: (bool: Optional) Which server to fetch the data from</span>
<span class="sd">    :param web: (bool: Optional) If ``True``, the result will be reprojected</span>
<span class="sd">    :param plot: (bool: Optional) If ``True``, the result will be plotted</span>
<span class="sd">    :return: (GeoPandas GeoDataFrame, plot(Optional)) The resulting `GeoPandas GeoDataFrame`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># If area has numbers in it, use  re.search(r&quot;\d+\s*(.*)&quot;, area).group(1)</span>
    <span class="c1"># Clean area name</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">char</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">area</span><span class="p">):</span>
        <span class="n">area</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\d+\s*(.*)&quot;</span><span class="p">,</span> <span class="n">area</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="n">layer</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">feature</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">layer</span> <span class="o">=</span> <span class="s2">&quot;se_got_trs_roads_tv&quot;</span>
    <span class="k">elif</span> <span class="n">feature</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">layer</span> <span class="o">=</span> <span class="s2">&quot;se_got_phy_buildingfootprint_lm&quot;</span>
    <span class="n">selectInString</span> <span class="o">=</span> <span class="s1">&#39;SELECT &#39;</span> <span class="o">+</span> <span class="n">layer</span> <span class="o">+</span> <span class="s1">&#39;.geom&#39;</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">KEY</span><span class="p">:</span>
        <span class="n">selectOutString</span> <span class="o">=</span> <span class="n">selectInString</span> <span class="o">+</span> <span class="s1">&#39; , &#39;</span> <span class="o">+</span> <span class="n">layer</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">k</span>
        <span class="n">selectInString</span> <span class="o">=</span> <span class="n">selectOutString</span>
    <span class="n">SELECT</span> <span class="o">=</span> <span class="n">selectInString</span>

    <span class="c1"># Adding conditionals</span>
    <span class="k">if</span> <span class="nb">filter</span><span class="p">:</span>
        <span class="n">COND</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1"> AND &#39;</span> <span class="o">+</span> <span class="n">layer</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">KEY</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; = </span><span class="se">\&#39;</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">VAL</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">COND</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="c1"># Building SQL</span>
    <span class="n">FROM</span> <span class="o">=</span> <span class="s1">&#39; FROM &#39;</span> <span class="o">+</span> <span class="n">layer</span>
    <span class="n">JOIN</span> <span class="o">=</span> <span class="s1">&#39; JOIN se_got_bnd_admin10_osm ON &#39;</span>
    <span class="n">CONTAIN</span> <span class="o">=</span> <span class="s1">&#39;ST_Contains(se_got_bnd_admin10_osm.geom,&#39;</span> <span class="o">+</span> <span class="n">layer</span> <span class="o">+</span> <span class="s1">&#39;.geom)&#39;</span>
    <span class="n">WHERE</span> <span class="o">=</span> <span class="s1">&#39; WHERE se_got_bnd_admin10_osm.name =</span><span class="se">\&#39;</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">area</span> <span class="o">+</span> <span class="n">COND</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">;&#39;</span>
    <span class="n">sql</span> <span class="o">=</span> <span class="n">SELECT</span> <span class="o">+</span> <span class="n">FROM</span> <span class="o">+</span> <span class="n">JOIN</span> <span class="o">+</span> <span class="n">CONTAIN</span> <span class="o">+</span> <span class="n">WHERE</span>
    <span class="c1">####logger.info(sql)</span>

    <span class="c1"># Get secrets</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">get_pgcon</span><span class="p">(</span><span class="n">local</span><span class="o">=</span><span class="n">local</span><span class="p">)</span>
    <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_postgis</span><span class="p">(</span><span class="n">sql</span><span class="o">=</span><span class="n">sql</span><span class="p">,</span>
                           <span class="n">con</span><span class="o">=</span><span class="n">con</span><span class="p">,</span>
                           <span class="n">geom_col</span><span class="o">=</span><span class="s1">&#39;geom&#39;</span><span class="p">)</span>
    <span class="c1"># Switching database</span>
    <span class="k">if</span> <span class="n">web</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">gdf</span>

    <span class="c1"># Plotting</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">area</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">title</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="n">result</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
                    <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">legend_kwds</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;static/&#39;</span> <span class="o">+</span> <span class="n">area</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.od.get_landuse" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_landuse</span><span class="p">(</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">web</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">buffer_distance</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>A function to fetch land use data as a GeoPandas GeoDataFrame, 
with an option to clip it using a provided geometry and buffer the clip.</p>
<p>:param local: If True, data will be fetched from the local server.
:param web: If True, result will be reprojected to EPSG:4326.
:param clip: Geometry to clip the natural features. Expected to be a Shapely Polygon.
:param buffer_distance: The distance to buffer around the clip geometry, default is 1000 meters.
:return: A GeoDataFrame containing the land use data.</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\od.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_landuse</span><span class="p">(</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">web</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">buffer_distance</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A function to fetch land use data as a GeoPandas GeoDataFrame, </span>
<span class="sd">    with an option to clip it using a provided geometry and buffer the clip.</span>

<span class="sd">    :param local: If True, data will be fetched from the local server.</span>
<span class="sd">    :param web: If True, result will be reprojected to EPSG:4326.</span>
<span class="sd">    :param clip: Geometry to clip the natural features. Expected to be a Shapely Polygon.</span>
<span class="sd">    :param buffer_distance: The distance to buffer around the clip geometry, default is 1000 meters.</span>
<span class="sd">    :return: A GeoDataFrame containing the land use data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">get_pgcon</span><span class="p">(</span><span class="n">local</span><span class="o">=</span><span class="n">local</span><span class="p">)</span>

    <span class="c1"># Start with base SQL query to select all columns</span>
    <span class="n">sql</span> <span class="o">=</span> <span class="s1">&#39;SELECT * FROM se_got_phy_naturalfeatures_lm&#39;</span>

    <span class="c1"># If a clipping polygon is provided, modify the SQL query to include a WHERE clause</span>
    <span class="k">if</span> <span class="n">clip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Validate the clip object is a Polygon and buffer it</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">clip</span><span class="p">,</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">Polygon</span><span class="p">):</span>
            <span class="n">wkt</span> <span class="o">=</span> <span class="n">clip</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">buffer_distance</span><span class="p">)</span><span class="o">.</span><span class="n">wkt</span>
            <span class="n">sql</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39; WHERE ST_Intersects(geom, ST_GeomFromText(</span><span class="se">\&#39;</span><span class="si">{</span><span class="n">wkt</span><span class="si">}</span><span class="se">\&#39;</span><span class="s1">, 3006))&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The clip parameter must be a Shapely Polygon.&#39;</span><span class="p">)</span>

    <span class="c1"># Fetch the data from the database</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_postgis</span><span class="p">(</span><span class="n">sql</span><span class="o">=</span><span class="n">sql</span><span class="p">,</span> <span class="n">con</span><span class="o">=</span><span class="n">con</span><span class="p">,</span> <span class="n">geom_col</span><span class="o">=</span><span class="s1">&#39;geom&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred while connecting to the database: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Reproject if web is True</span>
    <span class="k">if</span> <span class="n">web</span><span class="p">:</span>
        <span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">gdf</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.od.get_pg_query" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_pg_query</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">local</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">web</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>A utility function that fetches any data using an <code>SQL</code> query from the <code>PostGIS</code> Server
This function is a basic wrapper for the <code>psycopg2</code> module with secrets included.</p>
<p>:param sql: (str) An SQL query string
:param local: (bool: Optional) If <code>True</code>, data will be fetched from the local server
:param web: (bool: Optional) If <code>True</code>, result will be reprojected to <code>EPSG:4326</code>
:return:</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\od.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_pg_query</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">local</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">web</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A utility function that fetches any data using an ``SQL`` query from the ``PostGIS`` Server</span>
<span class="sd">    This function is a basic wrapper for the ``psycopg2`` module with secrets included.</span>

<span class="sd">    :param sql: (str) An SQL query string</span>
<span class="sd">    :param local: (bool: Optional) If ``True``, data will be fetched from the local server</span>
<span class="sd">    :param web: (bool: Optional) If ``True``, result will be reprojected to ``EPSG:4326``</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">get_pgcon</span><span class="p">(</span><span class="n">local</span><span class="o">=</span><span class="n">local</span><span class="p">)</span>
    <span class="c1">####logger.info(sql)</span>
    <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_postgis</span><span class="p">(</span><span class="n">sql</span><span class="o">=</span><span class="n">sql</span><span class="p">,</span>
                           <span class="n">con</span><span class="o">=</span><span class="n">con</span><span class="p">,</span>
                           <span class="n">geom_col</span><span class="o">=</span><span class="s1">&#39;geom&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">web</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">gdf</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.od.get_pgcon" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_pgcon</span><span class="p">(</span><span class="n">local</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>A helper function to read the <code>.pgpass</code> file. This is the authentication file for the <code>PostGIS</code> server. 
The function reads the file and returns a connection object to the <code>PostGIS</code> server.
The server contains the spatial data for the region, including the road network and building footprints.</p>
<p>:param local: (bool: Optional) If <code>True</code>, the function will connect to the local server.
:return: (psycopg2 connection) A connection object to the <code>PostGIS</code> server.</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\od.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_pgcon</span><span class="p">(</span><span class="n">local</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A helper function to read the `.pgpass` file. This is the authentication file for the `PostGIS` server. </span>
<span class="sd">    The function reads the file and returns a connection object to the `PostGIS` server.</span>
<span class="sd">    The server contains the spatial data for the region, including the road network and building footprints.</span>

<span class="sd">    :param local: (bool: Optional) If ``True``, the function will connect to the local server.</span>
<span class="sd">    :return: (psycopg2 connection) A connection object to the `PostGIS` server.</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;secrets/.pgpass&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">local</span><span class="p">:</span>
            <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">password</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="c1"># Create connection string</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                           <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                           <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                           <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">con</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.od.get_road" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_road</span><span class="p">(</span><span class="n">local</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">web</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ped</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">buffer_distance</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>A function to fetch road data as a GeoPandas GeoDataFrame, with an option to clip it using a provided geometry and buffer the clip.</p>
<p>:param local: If True, data will be fetched from the local server.
:param web: If True, result will be reprojected to EPSG:4326.
:param ped: If True, pedestrian roads will be included in the result.
:param clip: Geometry to clip the road data. Expected to be a Shapely Polygon.
:param buffer_distance: The distance to buffer around the clip geometry, default is 1000 meters.
:return: A GeoDataFrame containing the road data.</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\od.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_road</span><span class="p">(</span><span class="n">local</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">web</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ped</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">buffer_distance</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A function to fetch road data as a GeoPandas GeoDataFrame, with an option to clip it using a provided geometry and buffer the clip.</span>

<span class="sd">    :param local: If True, data will be fetched from the local server.</span>
<span class="sd">    :param web: If True, result will be reprojected to EPSG:4326.</span>
<span class="sd">    :param ped: If True, pedestrian roads will be included in the result.</span>
<span class="sd">    :param clip: Geometry to clip the road data. Expected to be a Shapely Polygon.</span>
<span class="sd">    :param buffer_distance: The distance to buffer around the clip geometry, default is 1000 meters.</span>
<span class="sd">    :return: A GeoDataFrame containing the road data.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">con</span> <span class="o">=</span> <span class="n">get_pgcon</span><span class="p">(</span><span class="n">local</span><span class="o">=</span><span class="n">local</span><span class="p">)</span>

    <span class="c1"># Initialize a list to hold individual queries</span>
    <span class="n">queries</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Base SQL query for roads</span>
    <span class="n">road_query</span> <span class="o">=</span> <span class="s1">&#39;SELECT geom FROM se_got_trs_roads_tv&#39;</span>
    <span class="n">queries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">road_query</span><span class="p">)</span>

    <span class="c1"># Add pedestrian roads if needed</span>
    <span class="k">if</span> <span class="n">ped</span><span class="p">:</span>
        <span class="n">ped_query</span> <span class="o">=</span> <span class="s1">&#39;SELECT geom FROM se_got_trs_path_tv&#39;</span>
        <span class="n">queries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ped_query</span><span class="p">)</span>

    <span class="c1"># Modify individual queries to clip with provided polygon</span>
    <span class="k">if</span> <span class="n">clip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">wkt</span> <span class="o">=</span> <span class="n">clip</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">buffer_distance</span><span class="p">)</span><span class="o">.</span><span class="n">wkt</span>  <span class="c1"># Buffer 1km and convert Shapely Polygon to WKT</span>
        <span class="c1"># Apply the WHERE clause to each query</span>
        <span class="n">queries</span> <span class="o">=</span> <span class="p">[</span><span class="n">q</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; WHERE ST_Intersects(geom, ST_GeomFromText(&#39;</span><span class="si">{</span><span class="n">wkt</span><span class="si">}</span><span class="s2">&#39;, 3006))&quot;</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">queries</span><span class="p">]</span>

    <span class="c1"># Combine the queries with UNION ALL</span>
    <span class="n">sql</span> <span class="o">=</span> <span class="s1">&#39; UNION ALL &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">queries</span><span class="p">)</span>

    <span class="c1">#print(&quot;Final SQL Query:&quot;, sql)  # Debugging line</span>

    <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_postgis</span><span class="p">(</span><span class="n">sql</span><span class="o">=</span><span class="n">sql</span><span class="p">,</span> <span class="n">con</span><span class="o">=</span><span class="n">con</span><span class="p">,</span> <span class="n">geom_col</span><span class="o">=</span><span class="s1">&#39;geom&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">web</span><span class="p">:</span>
        <span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">gdf</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.od.mark_empty_buildings" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mark_empty_buildings</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>This function marks the buildings as empty if the population_total is 0.</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\od.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">mark_empty_buildings</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function marks the buildings as empty if the population_total is 0.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">building</span> <span class="ow">in</span> <span class="n">Building</span><span class="o">.</span><span class="n">instances</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">building</span><span class="o">.</span><span class="n">population_total</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">building</span><span class="o">.</span><span class="n">isEmpty</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.od.process_residential_buildings" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_residential_buildings</span><span class="p">(</span><span class="n">gdf_building</span><span class="p">,</span> <span class="n">area_per_person</span><span class="o">=</span><span class="mi">36</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>This function processes the residential buildings to calculate the number of people living in each building.
The function filters the buildings based on the area_per_person parameter and calculates the number of people living in each building.
The function also calculates the number of floors in each building and the total Built-up Area (BTA) of each building.
The function also assigns a UUID to each building.</p>
<p>The data for the area_per_person parameter is based on the average living area per person in Sweden. 
Reference: https://www.scb.se/en/finding-statistics/statistics-by-subject-area/household-finances/income-and-income-distribution/households-housing/pong/statistical-news/households-housing-2019/</p>
<p>A service area factor is applied to the area of the building based on the building type.
The service area factor is 0.85 for 'Flerfamiljshus' and 0.9 for all other building types.</p>
<p>:param gdf_building: (GeoPandas GeoDataFrame) A GeoDataFrame containing the building footprints.
:param area_per_person: (int: Optional) The area per person in square meters. Default is 36 m2.
:return: (GeoPandas GeoDataFrame) A GeoDataFrame containing the processed residential buildings.</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\od.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process_residential_buildings</span><span class="p">(</span><span class="n">gdf_building</span><span class="p">,</span> <span class="n">area_per_person</span><span class="o">=</span><span class="mi">36</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function processes the residential buildings to calculate the number of people living in each building.</span>
<span class="sd">    The function filters the buildings based on the area_per_person parameter and calculates the number of people living in each building.</span>
<span class="sd">    The function also calculates the number of floors in each building and the total Built-up Area (BTA) of each building.</span>
<span class="sd">    The function also assigns a UUID to each building.</span>

<span class="sd">    The data for the area_per_person parameter is based on the average living area per person in Sweden. </span>
<span class="sd">    Reference: https://www.scb.se/en/finding-statistics/statistics-by-subject-area/household-finances/income-and-income-distribution/households-housing/pong/statistical-news/households-housing-2019/</span>

<span class="sd">    A service area factor is applied to the area of the building based on the building type.</span>
<span class="sd">    The service area factor is 0.85 for &#39;Flerfamiljshus&#39; and 0.9 for all other building types.</span>

<span class="sd">    :param gdf_building: (GeoPandas GeoDataFrame) A GeoDataFrame containing the building footprints.</span>
<span class="sd">    :param area_per_person: (int: Optional) The area per person in square meters. Default is 36 m2.</span>
<span class="sd">    :return: (GeoPandas GeoDataFrame) A GeoDataFrame containing the processed residential buildings.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Average living area per person</span>
    <span class="c1"># https://www.scb.se/en/finding-statistics/statistics-by-subject-area/household-finances/income-and-income-distribution/households-housing/pong/statistical-news/households-housing-2019/</span>
    <span class="c1"># Split andamal_1t by &#39;;&#39; and create a new column for each value, new columns are byggnadstyp and byggnadsundergrupp</span>
    <span class="n">gdf_building</span><span class="p">[</span><span class="s1">&#39;byggnadstyp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_building</span><span class="p">[</span><span class="s1">&#39;andamal_1t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">gdf_building</span><span class="p">[</span><span class="s1">&#39;byggnadsundergrupp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_building</span><span class="p">[</span><span class="s1">&#39;andamal_1t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Filter Bostad only</span>
    <span class="n">gdf_residential</span> <span class="o">=</span> <span class="n">gdf_building</span><span class="p">[</span><span class="n">gdf_building</span><span class="p">[</span><span class="s1">&#39;byggnadstyp&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Bostad&#39;</span><span class="p">]</span>

    <span class="c1"># Remove buildings with area less than area_per_person m2</span>
    <span class="n">gdf_residential</span> <span class="o">=</span> <span class="n">gdf_residential</span><span class="p">[</span><span class="n">gdf_residential</span><span class="p">[</span><span class="s1">&#39;geom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">area</span> <span class="o">&gt;</span> <span class="n">area_per_person</span><span class="p">]</span>

    <span class="c1"># Plot the counts of each byggnadsundergrupp in gdf_residential</span>
    <span class="c1">#gdf_residential[&#39;byggnadsundergrupp&#39;].value_counts().plot(kind=&#39;bar&#39;)</span>

    <span class="c1"># Get number of floors from height where each floor is 3m high and round up such that minimum floors is 1</span>
    <span class="n">gdf_residential</span><span class="p">[</span><span class="s1">&#39;floors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_residential</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="mf">3.5</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

    <span class="c1"># Get BTA by calculating area of the shape and multiply by number of floors and round down</span>
    <span class="n">gdf_residential</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_residential</span><span class="p">[</span><span class="s1">&#39;geom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">area</span>

    <span class="c1"># Histo gram of areas for each byggnadsundergrupp</span>
    <span class="c1">#gdf_residential.hist(column=&#39;area&#39;, by=&#39;byggnadsundergrupp&#39;, bins=50, figsize=(20,15))</span>

    <span class="c1"># If house is &#39;Flerfamiljshus&#39;, multiply by 0.85 to account for service areas</span>
    <span class="n">gdf_residential</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gdf_residential</span><span class="p">[</span><span class="s1">&#39;byggnadsundergrupp&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Flerfamiljshus&#39;</span><span class="p">,</span> <span class="s1">&#39;area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_residential</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.7</span>

    <span class="c1"># For all other houses, multiply by 0.9 to account for service areas</span>
    <span class="n">gdf_residential</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gdf_residential</span><span class="p">[</span><span class="s1">&#39;byggnadsundergrupp&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Flerfamiljshus&#39;</span><span class="p">,</span> <span class="s1">&#39;area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_residential</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.8</span>

    <span class="c1"># Get BTA by calculating area of the shape and multiply by number of floors and round down</span>
    <span class="n">gdf_residential</span><span class="p">[</span><span class="s1">&#39;BTA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_residential</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_residential</span><span class="p">[</span><span class="s1">&#39;floors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="c1"># Add a column for number of people living in each building level (footprint_area/area_per_person) and round down</span>
    <span class="n">gdf_residential</span><span class="p">[</span><span class="s1">&#39;population_per_floor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_residential</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">area_per_person</span><span class="p">))</span>

    <span class="c1"># Add a column for number of people living in each building (people_per_floor * number of floors)</span>
    <span class="n">gdf_residential</span><span class="p">[</span><span class="s1">&#39;population_total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_residential</span><span class="p">[</span><span class="s1">&#39;population_per_floor&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_residential</span><span class="p">[</span><span class="s1">&#39;floors&#39;</span><span class="p">]</span>

    <span class="c1"># Add a uuid for each building using uuid4</span>
    <span class="c1"># Added automatically on creating he class</span>
    <span class="c1">#gdf_residential[&#39;uuid&#39;] = gdf_residential.apply(lambda x: uuid.uuid4(), axis=1)</span>
    <span class="c1">#gdf_residential.head()</span>
    <span class="k">return</span> <span class="n">gdf_residential</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.od.sort_buildings_by_type_and_population" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sort_buildings_by_type_and_population</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>This function sorts the buildings by type and population into single family and multi family buildings
Buildings are sorted by population in descending order.
Note: Population is calculated as the number of people living in the building based on the area_per_person parameter.</p>
<p>Returns:
single_family_buildings (list): A list of single family buildings sorted by population
multi_family_buildings (list): A list of multi family buildings sorted by population</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\od.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">sort_buildings_by_type_and_population</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function sorts the buildings by type and population into single family and multi family buildings</span>
<span class="sd">    Buildings are sorted by population in descending order.</span>
<span class="sd">    Note: Population is calculated as the number of people living in the building based on the area_per_person parameter.</span>

<span class="sd">    Returns:</span>
<span class="sd">    single_family_buildings (list): A list of single family buildings sorted by population</span>
<span class="sd">    multi_family_buildings (list): A list of multi family buildings sorted by population</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">single_family_house</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Smhus friliggande&#39;</span><span class="p">,</span> <span class="s1">&#39;Smhus kedjehus&#39;</span><span class="p">,</span> <span class="s1">&#39;Smhus radhus&#39;</span><span class="p">,</span> <span class="s1">&#39;Smhus med flera lgenheter&#39;</span><span class="p">]</span>
    <span class="n">multi_family_house</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Flerfamiljshus&#39;</span><span class="p">]</span>

    <span class="n">single_family_buildings</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">building</span> <span class="k">for</span> <span class="n">building</span> <span class="ow">in</span> <span class="n">Building</span><span class="o">.</span><span class="n">instances</span> <span class="k">if</span> <span class="n">building</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="n">single_family_house</span><span class="p">]</span>
    <span class="n">single_family_buildings</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">population_total</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">multi_family_buildings</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">building</span> <span class="k">for</span> <span class="n">building</span> <span class="ow">in</span> <span class="n">Building</span><span class="o">.</span><span class="n">instances</span> <span class="k">if</span> <span class="n">building</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="n">multi_family_house</span><span class="p">]</span>
    <span class="n">multi_family_buildings</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">population_total</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">multi_family_buildings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No multi family buildings found&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">single_family_buildings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No single family buildings found&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">single_family_buildings</span><span class="p">,</span> <span class="n">multi_family_buildings</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.od.sort_households_by_type_and_count" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sort_households_by_type_and_count</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>This function sorts the households by type and population into single family and multi family households
Households are sorted by population in descending order.
Returns:
households_in_single_family_house (list): A list of single family households sorted by population
households_in_multi_family_house (list): A list of multi family households sorted by population</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\od.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">sort_households_by_type_and_count</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function sorts the households by type and population into single family and multi family households</span>
<span class="sd">    Households are sorted by population in descending order.</span>
<span class="sd">    Returns:</span>
<span class="sd">    households_in_single_family_house (list): A list of single family households sorted by population</span>
<span class="sd">    households_in_multi_family_house (list): A list of multi family households sorted by population</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">households_in_single_family_house</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">household</span> <span class="k">for</span> <span class="n">household</span> <span class="ow">in</span> <span class="n">Household</span><span class="o">.</span><span class="n">instances</span> <span class="k">if</span> <span class="n">household</span><span class="o">.</span><span class="n">house_type</span> <span class="o">==</span> <span class="s1">&#39;Villa&#39;</span><span class="p">]</span>
    <span class="n">households_in_single_family_house</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">members</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">households_in_multi_family_house</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">household</span> <span class="k">for</span> <span class="n">household</span> <span class="ow">in</span> <span class="n">Household</span><span class="o">.</span><span class="n">instances</span> <span class="k">if</span> <span class="n">household</span><span class="o">.</span><span class="n">house_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Apartment&#39;</span><span class="p">,</span> <span class="s1">&#39;Other&#39;</span><span class="p">]]</span>
    <span class="n">households_in_multi_family_house</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">members</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">households_in_single_family_house</span><span class="p">,</span> <span class="n">households_in_multi_family_house</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
