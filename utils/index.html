<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>utils - Tripsender Documentation</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../assets/_mkdocstrings.css" rel="stylesheet">
        <link href="../stylesheets/extra.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Tripsender Documentation</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href=".." class="nav-link">Welcome to tripsender</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">API Documentation</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../activity/" class="dropdown-item">activity</a>
</li>
                                    
<li>
    <a href="../building/" class="dropdown-item">building</a>
</li>
                                    
<li>
    <a href="../house/" class="dropdown-item">house</a>
</li>
                                    
<li>
    <a href="../household/" class="dropdown-item">household</a>
</li>
                                    
<li>
    <a href="../io/" class="dropdown-item">io</a>
</li>
                                    
<li>
    <a href="../location_assignment/" class="dropdown-item">location_assignment</a>
</li>
                                    
<li>
    <a href="../nhts/" class="dropdown-item">nhts</a>
</li>
                                    
<li>
    <a href="../od/" class="dropdown-item">od</a>
</li>
                                    
<li>
    <a href="../person/" class="dropdown-item">person</a>
</li>
                                    
<li>
    <a href="../population/" class="dropdown-item">population</a>
</li>
                                    
<li>
    <a href="../routing/" class="dropdown-item">routing</a>
</li>
                                    
<li>
    <a href="../sampler/" class="dropdown-item">sampler</a>
</li>
                                    
<li>
    <a href="../synthpop/" class="dropdown-item">synthpop</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">utils</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../synthpop/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" class="nav-link disabled">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.utils" class="nav-link">utils</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.utils.assign_cars_to_households" class="nav-link">assign_cars_to_households</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.utils.assign_children_to_households" class="nav-link">assign_children_to_households</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.utils.assign_house_type_to_households" class="nav-link">assign_house_type_to_households</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.utils.assign_house_type_to_households_old" class="nav-link">assign_house_type_to_households_old</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.utils.assign_primary_status_to_members" class="nav-link">assign_primary_status_to_members</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.utils.assign_primary_status_to_members_backup" class="nav-link">assign_primary_status_to_members_backup</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.utils.balance_lists" class="nav-link">balance_lists</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.utils.calculate_similarity" class="nav-link">calculate_similarity</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.utils.cap_cars_per_household" class="nav-link">cap_cars_per_household</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.utils.clear_instances" class="nav-link">clear_instances</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.utils.couples_from_individuals" class="nav-link">couples_from_individuals</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.utils.get_older_child_probability_matrix" class="nav-link">get_older_child_probability_matrix</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.utils.get_probability_of_children" class="nav-link">get_probability_of_children</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.utils.get_probability_of_housetype" class="nav-link">get_probability_of_housetype</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.utils.get_younger_child_probability_matrix" class="nav-link">get_younger_child_probability_matrix</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.utils.impute_municipal_children_count" class="nav-link">impute_municipal_children_count</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.utils.match_child_to_parent" class="nav-link">match_child_to_parent</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.utils.match_list_household_children" class="nav-link">match_list_household_children</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.utils.parse_num_children" class="nav-link">parse_num_children</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.utils.preprocess_household_data" class="nav-link">preprocess_household_data</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.utils.sample_children_category" class="nav-link">sample_children_category</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.utils.sample_household_for_older_child" class="nav-link">sample_household_for_older_child</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.utils.search_primary_area" class="nav-link">search_primary_area</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#tripsender.utils.split_households_by_householdtype" class="nav-link">split_households_by_householdtype</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<div class="doc doc-object doc-module">



<a id="tripsender.utils"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="tripsender.utils.assign_cars_to_households" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">assign_cars_to_households</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">area</span><span class="p">,</span> <span class="n">classifier</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Assign car ownership to households based on a classifier model.</p>
<p>This function assigns car ownership to households in the specified year and area
using a pre-trained classifier model. It predicts the probability of car ownership
for each household and assigns cars based on the top predictions.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>year</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The year for which to assign car ownership.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>area</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The geographical area for which to assign car ownership.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>classifier</code></td>
            <td>
                  <code>object</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The pre-trained classifier model for predicting car ownership.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>The function performs the following steps:
1. Fetches car ownership data for the specified year and area.
2. Preprocesses household data for model input.
3. Predicts the probability of car ownership for each household.
4. Assigns car ownership based on the top predictions.
5. Caps the number of cars per household to a specified maximum.
6. Logs the total number of cars after capping.</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">assign_cars_to_households</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">area</span><span class="p">,</span> <span class="n">classifier</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Assign car ownership to households based on a classifier model.</span>

<span class="sd">    This function assigns car ownership to households in the specified year and area</span>
<span class="sd">    using a pre-trained classifier model. It predicts the probability of car ownership</span>
<span class="sd">    for each household and assigns cars based on the top predictions.</span>

<span class="sd">    Args:</span>
<span class="sd">        year (int): The year for which to assign car ownership.</span>
<span class="sd">        area (str): The geographical area for which to assign car ownership.</span>
<span class="sd">        classifier (object): The pre-trained classifier model for predicting car ownership.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    The function performs the following steps:</span>
<span class="sd">    1. Fetches car ownership data for the specified year and area.</span>
<span class="sd">    2. Preprocesses household data for model input.</span>
<span class="sd">    3. Predicts the probability of car ownership for each household.</span>
<span class="sd">    4. Assigns car ownership based on the top predictions.</span>
<span class="sd">    5. Caps the number of cars per household to a specified maximum.</span>
<span class="sd">    6. Logs the total number of cars after capping.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Provide the estimated total cars and call the function to scale and optionally plot the results</span>
    <span class="n">car_data</span> <span class="o">=</span> <span class="n">fetch_car_data</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">area</span><span class="p">)</span>
    <span class="n">estimated_total_cars</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">car_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;values&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total estimated cars in neighborhood: </span><span class="si">{</span><span class="n">estimated_total_cars</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">aligned_columns</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;child_count&#39;</span><span class="p">,</span> <span class="s1">&#39;adult_count&#39;</span><span class="p">,</span> <span class="s1">&#39;x0_Kvinnor&#39;</span><span class="p">,</span> <span class="s1">&#39;x0_Män&#39;</span><span class="p">,</span> <span class="s1">&#39;x0_Other&#39;</span><span class="p">,</span>
        <span class="s1">&#39;x1_16-24&#39;</span><span class="p">,</span> <span class="s1">&#39;x1_25-34&#39;</span><span class="p">,</span> <span class="s1">&#39;x1_35-44&#39;</span><span class="p">,</span> <span class="s1">&#39;x1_45-54&#39;</span><span class="p">,</span> <span class="s1">&#39;x1_55-64&#39;</span><span class="p">,</span> <span class="s1">&#39;x1_65-74&#39;</span><span class="p">,</span>
        <span class="s1">&#39;x1_75+&#39;</span><span class="p">,</span> <span class="s1">&#39;x2_Apartment&#39;</span><span class="p">,</span> <span class="s1">&#39;x2_Other&#39;</span><span class="p">,</span> <span class="s1">&#39;x2_Villa&#39;</span><span class="p">,</span> <span class="s1">&#39;x3_Couple&#39;</span><span class="p">,</span>
        <span class="s1">&#39;x3_Other&#39;</span><span class="p">,</span> <span class="s1">&#39;x3_Single&#39;</span><span class="p">,</span> <span class="s1">&#39;x2_Not Available&#39;</span>
    <span class="p">]</span>
    <span class="n">df</span><span class="p">,</span> <span class="n">adults</span> <span class="o">=</span> <span class="n">preprocess_household_data</span><span class="p">(</span><span class="n">aligned_columns</span> <span class="o">=</span> <span class="n">aligned_columns</span><span class="p">,</span> <span class="n">drop</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;car_count&#39;</span><span class="p">,</span> <span class="s1">&#39;primary_status&#39;</span><span class="p">],</span> <span class="n">onehotencode</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Predict probabilities using the classifier</span>
    <span class="n">probs</span> <span class="o">=</span> <span class="n">classifier</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">df</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Assign car_count based on the top estimated_total_cars predictions</span>
    <span class="n">top_indices</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">probs</span><span class="p">)</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[:</span><span class="n">estimated_total_cars</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;car_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">top_indices</span><span class="p">,</span> <span class="s1">&#39;car_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># Assign cars to individuals and calculate household cars</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">person</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">adults</span><span class="p">):</span>
        <span class="n">person</span><span class="o">.</span><span class="n">has_car</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;car_count&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">household</span> <span class="ow">in</span> <span class="n">Household</span><span class="o">.</span><span class="n">instances</span><span class="p">:</span>
        <span class="n">household</span><span class="o">.</span><span class="n">cars</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">has_car</span> <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">household</span><span class="o">.</span><span class="n">members</span><span class="p">)</span>

    <span class="c1"># Cap the number of cars per household to a maximum of 3</span>
    <span class="n">cap_cars_per_household</span><span class="p">(</span><span class="n">Household</span><span class="o">.</span><span class="n">instances</span><span class="p">)</span>

    <span class="n">total_cars_after_capping</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">household</span><span class="o">.</span><span class="n">cars</span> <span class="k">for</span> <span class="n">household</span> <span class="ow">in</span> <span class="n">Household</span><span class="o">.</span><span class="n">instances</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total cars in neighborhood after capping to 4: </span><span class="si">{</span><span class="n">total_cars_after_capping</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.utils.assign_children_to_households" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">assign_children_to_households</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">area</span><span class="p">,</span> <span class="n">children</span><span class="p">,</span> <span class="n">age_split</span><span class="p">,</span> <span class="n">min_age_of_parent</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Assign children to households based on age and probability data.</p>
<p>This function assigns children to households for the specified year and area
using probability data and age-based categorization. It splits households into
different categories based on the age of the head and assigns children accordingly.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>year</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The year for which to assign children.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>area</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The geographical area for which to assign children.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>children</code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of children to be assigned.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>age_split</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The age threshold to categorize households.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>min_age_of_parent</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The minimum age for a parent. Defaults to 25.</p>
              </div>
            </td>
            <td>
                  <code>25</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>The function performs the following steps:
1. Determines if a household has children based on probability data.
2. Splits households into different categories based on the age of the head.
3. Assigns the number of children to each household based on the probability matrix.
4. Randomly adjusts the number of children in households to match the total number of children.
5. Matches children to households based on the number of children needed.
6. Updates the has_child attribute for each person in the household.
7. Logs the assignment process and results.</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">assign_children_to_households</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">area</span><span class="p">,</span> <span class="n">children</span> <span class="p">,</span> <span class="n">age_split</span><span class="p">,</span> <span class="n">min_age_of_parent</span> <span class="o">=</span> <span class="mi">25</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Assign children to households based on age and probability data.</span>

<span class="sd">    This function assigns children to households for the specified year and area</span>
<span class="sd">    using probability data and age-based categorization. It splits households into</span>
<span class="sd">    different categories based on the age of the head and assigns children accordingly.</span>

<span class="sd">    Args:</span>
<span class="sd">        year (int): The year for which to assign children.</span>
<span class="sd">        area (str): The geographical area for which to assign children.</span>
<span class="sd">        children (list): The list of children to be assigned.</span>
<span class="sd">        age_split (int): The age threshold to categorize households.</span>
<span class="sd">        min_age_of_parent (int, optional): The minimum age for a parent. Defaults to 25.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    The function performs the following steps:</span>
<span class="sd">    1. Determines if a household has children based on probability data.</span>
<span class="sd">    2. Splits households into different categories based on the age of the head.</span>
<span class="sd">    3. Assigns the number of children to each household based on the probability matrix.</span>
<span class="sd">    4. Randomly adjusts the number of children in households to match the total number of children.</span>
<span class="sd">    5. Matches children to households based on the number of children needed.</span>
<span class="sd">    6. Updates the has_child attribute for each person in the household.</span>
<span class="sd">    7. Logs the assignment process and results.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Step 1 - Determine if a household has children</span>
    <span class="n">households</span> <span class="o">=</span> <span class="n">Household</span><span class="o">.</span><span class="n">instances</span>
    <span class="n">households</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">household</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="n">member</span><span class="o">.</span><span class="n">age</span> <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">household</span><span class="o">.</span><span class="n">members</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">member</span><span class="o">.</span><span class="n">is_child</span><span class="p">]))</span>

    <span class="c1"># Get probability of having children</span>
    <span class="n">p_children</span> <span class="o">=</span> <span class="n">get_probability_of_children</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">area</span><span class="p">)</span>

    <span class="c1"># Given the household type, calculate the probability of having children in household.has_children</span>
    <span class="k">for</span> <span class="n">household</span> <span class="ow">in</span> <span class="n">households</span><span class="p">:</span>
        <span class="n">category</span> <span class="o">=</span> <span class="n">household</span><span class="o">.</span><span class="n">category</span>
        <span class="c1"># Single parent households are assumed to have children already</span>
        <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="s1">&#39;Couple&#39;</span><span class="p">:</span>
            <span class="n">household</span><span class="o">.</span><span class="n">has_children</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="n">p_children</span><span class="p">[</span><span class="s1">&#39;Couple&#39;</span><span class="p">][</span><span class="kc">True</span><span class="p">],</span> <span class="n">p_children</span><span class="p">[</span><span class="s1">&#39;Couple&#39;</span><span class="p">][</span><span class="kc">False</span><span class="p">]])</span>
        <span class="k">elif</span> <span class="n">category</span> <span class="o">==</span> <span class="s1">&#39;Other&#39;</span><span class="p">:</span>
            <span class="n">household</span><span class="o">.</span><span class="n">has_children</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="n">p_children</span><span class="p">[</span><span class="s1">&#39;Other&#39;</span><span class="p">][</span><span class="kc">True</span><span class="p">],</span> <span class="n">p_children</span><span class="p">[</span><span class="s1">&#39;Other&#39;</span><span class="p">][</span><span class="kc">False</span><span class="p">]])</span>

    <span class="c1"># Step 2 - Determine the age at which a person had their first child 25 years ago</span>

    <span class="c1"># Filter households that have children and are either Couple or Other</span>
    <span class="n">households_with_children</span> <span class="o">=</span> <span class="p">[</span><span class="n">household</span> <span class="k">for</span> <span class="n">household</span> <span class="ow">in</span> <span class="n">households</span> <span class="k">if</span> <span class="n">household</span><span class="o">.</span><span class="n">has_children</span> <span class="ow">and</span> <span class="n">household</span><span class="o">.</span><span class="n">category</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Single&#39;</span><span class="p">,</span> <span class="s1">&#39;Couple&#39;</span><span class="p">,</span> <span class="s1">&#39;Other&#39;</span><span class="p">]]</span>

    <span class="c1"># Split households based on the age of the head</span>
    <span class="c1"># These will get older children above 45</span>
    <span class="n">households_with_children_above_age_split</span> <span class="o">=</span> <span class="p">[</span><span class="n">household</span> <span class="k">for</span> <span class="n">household</span> <span class="ow">in</span> <span class="n">households_with_children</span> <span class="k">if</span> <span class="n">household</span><span class="o">.</span><span class="n">members</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;</span> <span class="n">age_split</span><span class="p">]</span>

    <span class="c1"># These will get younger children below 45</span>
    <span class="n">households_with_children_below_age_split</span> <span class="o">=</span> <span class="p">[</span><span class="n">household</span> <span class="k">for</span> <span class="n">household</span> <span class="ow">in</span> <span class="n">households_with_children</span> <span class="k">if</span> <span class="n">household</span><span class="o">.</span><span class="n">members</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">age</span> <span class="o">&lt;=</span> <span class="n">age_split</span><span class="p">]</span>

    <span class="c1"># Get the probability matrix for the number of children in each household category</span>
    <span class="n">p_matrix_0_24</span><span class="p">,</span> <span class="n">p_matrix_25</span> <span class="o">=</span> <span class="n">impute_municipal_children_count</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">area</span><span class="p">)</span>

    <span class="c1"># Step 3 - Assign number of children to households with children</span>
    <span class="k">for</span> <span class="n">household</span> <span class="ow">in</span> <span class="n">households_with_children_below_age_split</span><span class="p">:</span>
        <span class="c1"># Get household category</span>
        <span class="n">category</span> <span class="o">=</span> <span class="n">household</span><span class="o">.</span><span class="n">category</span>

        <span class="c1"># Get the probability matrix for the household category</span>
        <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="s1">&#39;Single&#39;</span><span class="p">:</span>
            <span class="n">p_matrix</span> <span class="o">=</span> <span class="n">p_matrix_0_24</span><span class="p">[</span><span class="s1">&#39;Single&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">category</span> <span class="o">==</span> <span class="s1">&#39;Couple&#39;</span><span class="p">:</span>
            <span class="n">p_matrix</span> <span class="o">=</span> <span class="n">p_matrix_0_24</span><span class="p">[</span><span class="s1">&#39;Couple&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">category</span> <span class="o">==</span> <span class="s1">&#39;Other&#39;</span><span class="p">:</span>
            <span class="n">p_matrix</span> <span class="o">=</span> <span class="n">p_matrix_0_24</span><span class="p">[</span><span class="s1">&#39;Other&#39;</span><span class="p">]</span>

        <span class="c1"># Sample from p_matrix</span>
        <span class="n">household</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span> <span class="n">p_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p_matrix</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p_matrix</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span>

    <span class="c1"># Repeat for households with children and age of head above 50</span>
    <span class="k">for</span> <span class="n">household</span> <span class="ow">in</span> <span class="n">households_with_children_above_age_split</span><span class="p">:</span>
        <span class="c1"># Get household category</span>
        <span class="n">category</span> <span class="o">=</span> <span class="n">household</span><span class="o">.</span><span class="n">category</span>
        <span class="c1"># Get the probability matrix for the household category</span>
        <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="s1">&#39;Single&#39;</span><span class="p">:</span>
            <span class="n">p_matrix</span> <span class="o">=</span> <span class="n">p_matrix_25</span><span class="p">[</span><span class="s1">&#39;Single&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="s1">&#39;Couple&#39;</span><span class="p">:</span>
            <span class="n">p_matrix</span> <span class="o">=</span> <span class="n">p_matrix_25</span><span class="p">[</span><span class="s1">&#39;Couple&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">category</span> <span class="o">==</span> <span class="s1">&#39;Other&#39;</span><span class="p">:</span>
            <span class="n">p_matrix</span> <span class="o">=</span> <span class="n">p_matrix_25</span><span class="p">[</span><span class="s1">&#39;Other&#39;</span><span class="p">]</span>

        <span class="c1"># Sample from p_matrix</span>
        <span class="n">household</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="n">p_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p_matrix</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p_matrix</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span>

    <span class="c1"># log number of children in households_with_children</span>
    <span class="n">total_children_in_households</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">household</span><span class="o">.</span><span class="n">children</span> <span class="k">for</span> <span class="n">household</span> <span class="ow">in</span> <span class="n">households_with_children</span><span class="p">)</span>



    <span class="c1"># Randomly increase household.children to households with children &lt; 3 until len(children) == total_children_in_households</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">children</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">total_children_in_households</span><span class="p">:</span>
        <span class="c1"># Optionally shuffle the households to randomize which ones get extra children</span>
        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">households_with_children</span><span class="p">)</span>

        <span class="n">increased</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Flag to check if any household&#39;s child count was increased in this iteration</span>

        <span class="k">for</span> <span class="n">household</span> <span class="ow">in</span> <span class="n">households_with_children</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">household</span><span class="o">.</span><span class="n">children</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">household</span><span class="o">.</span><span class="n">children</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">total_children_in_households</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">increased</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">total_children_in_households</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">children</span><span class="p">):</span>
                    <span class="k">break</span>

        <span class="c1"># If no household&#39;s child count was increased in this iteration, break out of the loop to prevent infinite looping</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">increased</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total number of children to be assigned: </span><span class="si">{</span><span class="n">total_children_in_households</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total number of children: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">children</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">match_list_household_children</span><span class="p">(</span><span class="n">households_with_children</span><span class="p">,</span> <span class="n">children</span><span class="p">)</span>

    <span class="c1"># Update has_child attribute for each person in the household based on the number of children in the household</span>
    <span class="k">for</span> <span class="n">household</span> <span class="ow">in</span> <span class="n">households</span><span class="p">:</span>
        <span class="n">household</span><span class="o">.</span><span class="n">update_has_child</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.utils.assign_house_type_to_households" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">assign_house_type_to_households</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">area</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Assign house types to households based on probability data (improved method).</p>
<p>This function assigns house types to households in the specified year and area
using probability data fetched from external sources. It uses an improved method
that accounts for varying household sizes and assigns house types accordingly.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>year</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The year for which to assign house types.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>area</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The geographical area for which to assign house types.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>The function performs the following steps:
1. Fetches probability data for house types based on the specified year and area.
2. Maps household sizes to the corresponding house type key, with special handling for larger households.
3. Iterates through each household to assign house types based on the probability data.
4. Logs any cases where valid house type data is not available for certain household sizes.</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">assign_house_type_to_households</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">area</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Assign house types to households based on probability data (improved method).</span>

<span class="sd">    This function assigns house types to households in the specified year and area</span>
<span class="sd">    using probability data fetched from external sources. It uses an improved method</span>
<span class="sd">    that accounts for varying household sizes and assigns house types accordingly.</span>

<span class="sd">    Args:</span>
<span class="sd">        year (int): The year for which to assign house types.</span>
<span class="sd">        area (str): The geographical area for which to assign house types.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    The function performs the following steps:</span>
<span class="sd">    1. Fetches probability data for house types based on the specified year and area.</span>
<span class="sd">    2. Maps household sizes to the corresponding house type key, with special handling for larger households.</span>
<span class="sd">    3. Iterates through each household to assign house types based on the probability data.</span>
<span class="sd">    4. Logs any cases where valid house type data is not available for certain household sizes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p_housetype</span> <span class="o">=</span> <span class="n">get_probability_of_housetype</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">area</span><span class="p">)</span>

    <span class="c1"># Define a mapping from household size to the corresponding key in p_housetype</span>
    <span class="n">size_to_key_mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;1 person&#39;</span><span class="p">,</span>
        <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;2 personer&#39;</span><span class="p">,</span>
        <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;3 personer&#39;</span><span class="p">,</span>
        <span class="mi">4</span><span class="p">:</span> <span class="s1">&#39;4 personer&#39;</span><span class="p">,</span>
        <span class="mi">5</span><span class="p">:</span> <span class="s1">&#39;5 personer&#39;</span><span class="p">,</span>
        <span class="mi">6</span><span class="p">:</span> <span class="s1">&#39;6 eller fler personer&#39;</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="n">household</span> <span class="ow">in</span> <span class="n">Household</span><span class="o">.</span><span class="n">instances</span><span class="p">:</span>
        <span class="n">household_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">household</span><span class="o">.</span><span class="n">members</span><span class="p">)</span>

        <span class="c1"># For households larger than 6, start checking from &#39;6 eller fler personer&#39;</span>
        <span class="k">if</span> <span class="n">household_size</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>
            <span class="n">current_size</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">current_size</span> <span class="o">=</span> <span class="n">household_size</span>

        <span class="c1"># Flag to indicate if a house type has been assigned</span>
        <span class="n">assigned</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">while</span> <span class="n">current_size</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">size_to_key_mapping</span><span class="p">[</span><span class="n">current_size</span><span class="p">]</span>

            <span class="c1"># Check if there&#39;s valid probability data for the current size</span>
            <span class="n">probabilities</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">p_housetype</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">probabilities</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">house_type</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">p_housetype</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">p</span><span class="o">=</span><span class="n">probabilities</span><span class="p">)</span>
                <span class="n">household</span><span class="o">.</span><span class="n">house_type</span> <span class="o">=</span> <span class="n">house_type</span>
                <span class="n">assigned</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>  <span class="c1"># Exit the loop once a house type is assigned</span>

            <span class="n">current_size</span> <span class="o">-=</span> <span class="mi">1</span>  <span class="c1"># Decrement size to check the next smaller size</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">assigned</span><span class="p">:</span>  <span class="c1"># If no valid house type was assigned</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No valid house type data for household size </span><span class="si">{</span><span class="n">household_size</span><span class="si">}</span><span class="s2"> or smaller. No house type assigned.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.utils.assign_house_type_to_households_old" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">assign_house_type_to_households_old</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">area</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Assign house types to households based on probability data (old method).</p>
<p>This function assigns house types to households in the specified year and area
using probability data fetched from external sources. It uses an older method
that directly maps household sizes to house types.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>year</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The year for which to assign house types.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>area</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The geographical area for which to assign house types.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>The function performs the following steps:
1. Fetches probability data for house types based on the specified year and area.
2. Maps household sizes to the corresponding house type key.
3. Assigns house types to households based on the probability data.
4. Logs any cases where household size does not match the probability data.</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">assign_house_type_to_households_old</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">area</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Assign house types to households based on probability data (old method).</span>

<span class="sd">    This function assigns house types to households in the specified year and area</span>
<span class="sd">    using probability data fetched from external sources. It uses an older method</span>
<span class="sd">    that directly maps household sizes to house types.</span>

<span class="sd">    Args:</span>
<span class="sd">        year (int): The year for which to assign house types.</span>
<span class="sd">        area (str): The geographical area for which to assign house types.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    The function performs the following steps:</span>
<span class="sd">    1. Fetches probability data for house types based on the specified year and area.</span>
<span class="sd">    2. Maps household sizes to the corresponding house type key.</span>
<span class="sd">    3. Assigns house types to households based on the probability data.</span>
<span class="sd">    4. Logs any cases where household size does not match the probability data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p_housetype</span> <span class="o">=</span> <span class="n">get_probability_of_housetype</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">area</span><span class="p">)</span>

    <span class="c1"># Define a mapping from household size to the corresponding key in p_housetype</span>
    <span class="n">size_to_key_mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;1 person&#39;</span><span class="p">,</span>
        <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;2 personer&#39;</span><span class="p">,</span>
        <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;3 personer&#39;</span><span class="p">,</span>
        <span class="mi">4</span><span class="p">:</span> <span class="s1">&#39;4 personer&#39;</span><span class="p">,</span>
        <span class="mi">5</span><span class="p">:</span> <span class="s1">&#39;5 personer&#39;</span><span class="p">,</span>
        <span class="mi">6</span><span class="p">:</span> <span class="s1">&#39;6 eller fler personer&#39;</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="n">household</span> <span class="ow">in</span> <span class="n">Household</span><span class="o">.</span><span class="n">instances</span><span class="p">:</span>
        <span class="n">household_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">household</span><span class="o">.</span><span class="n">members</span><span class="p">)</span>

        <span class="c1"># Use the mapping to get the corresponding key for the household size</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">size_to_key_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">household_size</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">household_size</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>  <span class="c1"># Explicitly handle the case where size &gt; 6</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;6 eller fler personer&#39;</span>

        <span class="k">if</span> <span class="n">key</span><span class="p">:</span>
            <span class="n">house_type</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">p_housetype</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">p</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">p_housetype</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
            <span class="n">household</span><span class="o">.</span><span class="n">house_type</span> <span class="o">=</span> <span class="n">house_type</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;assign_house_type_to_households: Household size </span><span class="si">{</span><span class="n">household_size</span><span class="si">}</span><span class="s2"> not found in p_housetype&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.utils.assign_primary_status_to_members" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">assign_primary_status_to_members</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">area</span><span class="p">,</span> <span class="n">classifier</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Assign primary status (e.g., work, education, home) to household members.</p>
<p>This function assigns primary status to household members for the specified year and area
using a pre-trained classifier model. It predicts the probability of different primary statuses
for each individual and assigns the status based on the top predictions.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>year</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The year for which to assign primary status.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>area</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The geographical area for which to assign primary status.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>classifier</code></td>
            <td>
                  <code>object</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The pre-trained classifier model for predicting primary status.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>The function performs the following steps:
1. Fetches primary status data for the specified year and area.
2. Preprocesses household data for model input.
3. Predicts the probability of different primary statuses for each individual.
4. Assigns primary status to individuals based on the top predictions.
5. Logs the distribution of primary status among the household members.</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">assign_primary_status_to_members</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">area</span><span class="p">,</span><span class="n">classifier</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Assign primary status (e.g., work, education, home) to household members.</span>

<span class="sd">    This function assigns primary status to household members for the specified year and area</span>
<span class="sd">    using a pre-trained classifier model. It predicts the probability of different primary statuses</span>
<span class="sd">    for each individual and assigns the status based on the top predictions.</span>

<span class="sd">    Args:</span>
<span class="sd">        year (int): The year for which to assign primary status.</span>
<span class="sd">        area (str): The geographical area for which to assign primary status.</span>
<span class="sd">        classifier (object): The pre-trained classifier model for predicting primary status.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    The function performs the following steps:</span>
<span class="sd">    1. Fetches primary status data for the specified year and area.</span>
<span class="sd">    2. Preprocesses household data for model input.</span>
<span class="sd">    3. Predicts the probability of different primary statuses for each individual.</span>
<span class="sd">    4. Assigns primary status to individuals based on the top predictions.</span>
<span class="sd">    5. Logs the distribution of primary status among the household members.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">primary_dict</span> <span class="o">=</span> <span class="n">fetch_primary_status</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">area</span><span class="p">)</span>
    <span class="c1"># {&#39;WORK&#39;: &#39;6140&#39;, &#39;STUDY&#39;: &#39;505&#39;, &#39;INACTIVE&#39;: &#39;285&#39;}</span>
    <span class="n">working_count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">primary_dict</span><span class="p">[</span><span class="s1">&#39;WORK&#39;</span><span class="p">])</span>
    <span class="n">study_count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">primary_dict</span><span class="p">[</span><span class="s1">&#39;STUDY&#39;</span><span class="p">])</span>
    <span class="n">home_count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">primary_dict</span><span class="p">[</span><span class="s1">&#39;INACTIVE&#39;</span><span class="p">])</span>

    <span class="n">aligned_columns</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;child_count&#39;</span><span class="p">,</span> <span class="s1">&#39;adult_count&#39;</span><span class="p">,</span> <span class="s1">&#39;car_count&#39;</span><span class="p">,</span> <span class="s1">&#39;x0_Kvinnor&#39;</span><span class="p">,</span> <span class="s1">&#39;x0_Män&#39;</span><span class="p">,</span> <span class="s1">&#39;x0_Other&#39;</span><span class="p">,</span>
        <span class="s1">&#39;x1_16-24&#39;</span><span class="p">,</span> <span class="s1">&#39;x1_25-34&#39;</span><span class="p">,</span> <span class="s1">&#39;x1_35-44&#39;</span><span class="p">,</span> <span class="s1">&#39;x1_45-54&#39;</span><span class="p">,</span> <span class="s1">&#39;x1_55-64&#39;</span><span class="p">,</span> <span class="s1">&#39;x1_65-74&#39;</span><span class="p">,</span>
        <span class="s1">&#39;x1_75+&#39;</span><span class="p">,</span> <span class="s1">&#39;x2_Apartment&#39;</span><span class="p">,</span> <span class="s1">&#39;x2_Other&#39;</span><span class="p">,</span> <span class="s1">&#39;x2_Villa&#39;</span><span class="p">,</span> <span class="s1">&#39;x3_Couple&#39;</span><span class="p">,</span>
        <span class="s1">&#39;x3_Other&#39;</span><span class="p">,</span> <span class="s1">&#39;x3_Single&#39;</span><span class="p">,</span> <span class="s1">&#39;x2_Not Available&#39;</span>
    <span class="p">]</span>

    <span class="n">df</span><span class="p">,</span> <span class="n">adults</span> <span class="o">=</span> <span class="n">preprocess_household_data</span><span class="p">(</span><span class="n">aligned_columns</span> <span class="o">=</span> <span class="n">aligned_columns</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;primary_status&#39;</span><span class="p">],</span> <span class="n">onehotencode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Assume &#39;classifier&#39; and &#39;df&#39; are already defined and ready</span>
    <span class="n">probs</span> <span class="o">=</span> <span class="n">classifier</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="c1"># Initialize all to &#39;NA&#39; (or another default status)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;primary_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;NA&#39;</span>

    <span class="c1"># Sort indices based on probabilities for &#39;WORK&#39;</span>
    <span class="n">work_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="o">-</span><span class="n">probs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])[:</span><span class="n">working_count</span><span class="p">]</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">work_indices</span><span class="p">,</span> <span class="s1">&#39;primary_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;WORK&#39;</span>

    <span class="c1"># Exclude already assigned &#39;WORK&#39; from &#39;STUDY&#39;</span>
    <span class="n">remaining_for_study</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;primary_status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;NA&#39;</span><span class="p">]</span>
    <span class="n">study_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="o">-</span><span class="n">probs</span><span class="p">[</span><span class="n">remaining_for_study</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">])[:</span><span class="n">study_count</span><span class="p">]</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">study_indices</span><span class="p">,</span> <span class="s1">&#39;primary_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;EDUCATION&#39;</span>

    <span class="c1"># Assign &#39;HOME&#39; to the remaining, if needed</span>
    <span class="n">remaining_for_home</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;primary_status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;NA&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">remaining_for_home</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">home_count</span><span class="p">:</span>
        <span class="n">home_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="o">-</span><span class="n">probs</span><span class="p">[</span><span class="n">remaining_for_home</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="mi">2</span><span class="p">])[:</span><span class="n">home_count</span><span class="p">]</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">home_indices</span><span class="p">,</span> <span class="s1">&#39;primary_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;HOME&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">remaining_for_home</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;primary_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;HOME&#39;</span>

    <span class="c1"># Update the primary status of adults based on the DataFrame</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">adult</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">adults</span><span class="p">):</span>
        <span class="n">adult</span><span class="o">.</span><span class="n">primary_status</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;primary_status&#39;</span><span class="p">]</span>


    <span class="n">workers</span><span class="p">,</span> <span class="n">students</span><span class="p">,</span> <span class="n">neither</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">Person</span><span class="o">.</span><span class="n">instances</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">person</span><span class="o">.</span><span class="n">primary_status</span> <span class="o">==</span> <span class="s2">&quot;WORK&quot;</span><span class="p">:</span>
            <span class="n">workers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">person</span><span class="o">.</span><span class="n">primary_status</span> <span class="o">==</span> <span class="s2">&quot;EDUCATION&quot;</span><span class="p">:</span>
            <span class="n">students</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">person</span><span class="o">.</span><span class="n">primary_status</span> <span class="o">==</span> <span class="s2">&quot;HOME&quot;</span><span class="p">:</span>
            <span class="n">neither</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of workers: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">workers</span><span class="p">)</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">workers</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">instances</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of students: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">students</span><span class="p">)</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">students</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">instances</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of neither: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">neither</span><span class="p">)</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">neither</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">instances</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total number of persons: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">instances</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.utils.assign_primary_status_to_members_backup" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">assign_primary_status_to_members_backup</span><span class="p">(</span><span class="n">classifier</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Assign primary status (e.g., work, education, home) to household members using a backup method.</p>
<p>This function assigns primary status to household members using a pre-trained classifier model.
It predicts the primary status for each individual based on household data and assigns the
corresponding status to each member.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>classifier</code></td>
            <td>
                  <code>object</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The pre-trained classifier model for predicting primary status.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>The function performs the following steps:
1. Preprocesses household data for model input.
2. Predicts the primary status for each individual using the classifier.
3. Assigns the predicted primary status to each member.
4. Logs the distribution of primary status among the household members.</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">assign_primary_status_to_members_backup</span><span class="p">(</span><span class="n">classifier</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Assign primary status (e.g., work, education, home) to household members using a backup method.</span>

<span class="sd">    This function assigns primary status to household members using a pre-trained classifier model.</span>
<span class="sd">    It predicts the primary status for each individual based on household data and assigns the</span>
<span class="sd">    corresponding status to each member.</span>

<span class="sd">    Args:</span>
<span class="sd">        classifier (object): The pre-trained classifier model for predicting primary status.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    The function performs the following steps:</span>
<span class="sd">    1. Preprocesses household data for model input.</span>
<span class="sd">    2. Predicts the primary status for each individual using the classifier.</span>
<span class="sd">    3. Assigns the predicted primary status to each member.</span>
<span class="sd">    4. Logs the distribution of primary status among the household members.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">aligned_columns</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;child_count&#39;</span><span class="p">,</span> <span class="s1">&#39;adult_count&#39;</span><span class="p">,</span> <span class="s1">&#39;car_count&#39;</span><span class="p">,</span> <span class="s1">&#39;x0_Kvinnor&#39;</span><span class="p">,</span> <span class="s1">&#39;x0_Män&#39;</span><span class="p">,</span> <span class="s1">&#39;x0_Other&#39;</span><span class="p">,</span>
        <span class="s1">&#39;x1_16-24&#39;</span><span class="p">,</span> <span class="s1">&#39;x1_25-34&#39;</span><span class="p">,</span> <span class="s1">&#39;x1_35-44&#39;</span><span class="p">,</span> <span class="s1">&#39;x1_45-54&#39;</span><span class="p">,</span> <span class="s1">&#39;x1_55-64&#39;</span><span class="p">,</span> <span class="s1">&#39;x1_65-74&#39;</span><span class="p">,</span>
        <span class="s1">&#39;x1_75+&#39;</span><span class="p">,</span> <span class="s1">&#39;x2_Apartment&#39;</span><span class="p">,</span> <span class="s1">&#39;x2_Other&#39;</span><span class="p">,</span> <span class="s1">&#39;x2_Villa&#39;</span><span class="p">,</span> <span class="s1">&#39;x3_Couple&#39;</span><span class="p">,</span>
        <span class="s1">&#39;x3_Other&#39;</span><span class="p">,</span> <span class="s1">&#39;x3_Single&#39;</span><span class="p">,</span> <span class="s1">&#39;x2_Not Available&#39;</span>
    <span class="p">]</span>

    <span class="n">df</span><span class="p">,</span> <span class="n">adults</span> <span class="o">=</span> <span class="n">preprocess_household_data</span><span class="p">(</span><span class="n">aligned_columns</span> <span class="o">=</span> <span class="n">aligned_columns</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;primary_status&#39;</span><span class="p">],</span> <span class="n">onehotencode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Predict the primary status for each person using the classifier</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;primary_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="c1"># Add the primary status to each person</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">adult</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">adults</span><span class="p">):</span>
        <span class="n">numeric_primary_status</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;primary_status&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">numeric_primary_status</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">adult</span><span class="o">.</span><span class="n">primary_status</span> <span class="o">=</span> <span class="s1">&#39;WORK&#39;</span>
        <span class="k">elif</span> <span class="n">numeric_primary_status</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">adult</span><span class="o">.</span><span class="n">primary_status</span> <span class="o">=</span> <span class="s1">&#39;EDUCATION&#39;</span>
        <span class="k">elif</span> <span class="n">numeric_primary_status</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">adult</span><span class="o">.</span><span class="n">primary_status</span> <span class="o">=</span> <span class="s1">&#39;HOME&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">adult</span><span class="o">.</span><span class="n">primary_status</span> <span class="o">=</span> <span class="s1">&#39;NA&#39;</span>

    <span class="n">workers</span><span class="p">,</span> <span class="n">students</span><span class="p">,</span> <span class="n">neither</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">Person</span><span class="o">.</span><span class="n">instances</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">person</span><span class="o">.</span><span class="n">primary_status</span> <span class="o">==</span> <span class="s2">&quot;WORK&quot;</span><span class="p">:</span>
            <span class="n">workers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">person</span><span class="o">.</span><span class="n">primary_status</span> <span class="o">==</span> <span class="s2">&quot;EDUCATION&quot;</span><span class="p">:</span>
            <span class="n">students</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">person</span><span class="o">.</span><span class="n">primary_status</span> <span class="o">==</span> <span class="s2">&quot;HOME&quot;</span><span class="p">:</span>
            <span class="n">neither</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of workers: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">workers</span><span class="p">)</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">workers</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">instances</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of students: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">students</span><span class="p">)</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">students</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">instances</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of neither: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">neither</span><span class="p">)</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">neither</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">instances</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total number of persons: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">instances</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.utils.balance_lists" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">balance_lists</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Balance the lengths of two lists by moving excess individuals to a separate list.</p>
<p>This function ensures that the two input lists have the same length by moving excess individuals
from the longer list to a separate list of unmatched individuals.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>p1</code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The first list of individuals.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>p2</code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The second list of individuals.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the balanced lists and the list of unmatched individuals.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>The function performs the following steps:
1. Checks if the lengths of the two lists are equal.
2. If not, calculates the difference in lengths and moves excess individuals to a separate list.
3. Returns the balanced lists and the list of unmatched individuals.</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">balance_lists</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Balance the lengths of two lists by moving excess individuals to a separate list.</span>

<span class="sd">    This function ensures that the two input lists have the same length by moving excess individuals</span>
<span class="sd">    from the longer list to a separate list of unmatched individuals.</span>

<span class="sd">    Args:</span>
<span class="sd">        p1 (list): The first list of individuals.</span>
<span class="sd">        p2 (list): The second list of individuals.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing the balanced lists and the list of unmatched individuals.</span>

<span class="sd">    The function performs the following steps:</span>
<span class="sd">    1. Checks if the lengths of the two lists are equal.</span>
<span class="sd">    2. If not, calculates the difference in lengths and moves excess individuals to a separate list.</span>
<span class="sd">    3. Returns the balanced lists and the list of unmatched individuals.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">len_p1</span><span class="p">,</span> <span class="n">len_p2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>

    <span class="c1"># Check if the lists are already of equal length</span>
    <span class="k">if</span> <span class="n">len_p1</span> <span class="o">==</span> <span class="n">len_p2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="p">[]</span>

    <span class="c1"># Find the difference in lengths</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">len_p1</span> <span class="o">-</span> <span class="n">len_p2</span><span class="p">)</span>

    <span class="c1"># Move individuals to unmatched_individuals until the lengths are equal</span>
    <span class="n">unmatched_individuals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="n">diff</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">len_p1</span> <span class="o">&gt;</span> <span class="n">len_p2</span><span class="p">:</span>
            <span class="n">unmatched_individuals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">unmatched_individuals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p2</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>
        <span class="n">diff</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">unmatched_individuals</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.utils.calculate_similarity" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_similarity</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">area</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Calculate the similarity between the query and the area.</p>
<p>This function calculates the similarity score between the query string and the
area string based on various criteria such as exact match, missing characters,
and common characters.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>query</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The query string.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>area</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The area string to compare with the query.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The similarity score between the query and the area.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>The function performs the following steps:
1. Checks for an exact match and returns a high similarity score if found.
2. Checks for missing characters and returns a high similarity score if found.
3. Calculates the similarity based on the number of common characters between the query and the area.
4. Returns the similarity score.</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_similarity</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">area</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the similarity between the query and the area.</span>

<span class="sd">    This function calculates the similarity score between the query string and the</span>
<span class="sd">    area string based on various criteria such as exact match, missing characters,</span>
<span class="sd">    and common characters.</span>

<span class="sd">    Args:</span>
<span class="sd">        query (str): The query string.</span>
<span class="sd">        area (str): The area string to compare with the query.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: The similarity score between the query and the area.</span>

<span class="sd">    The function performs the following steps:</span>
<span class="sd">    1. Checks for an exact match and returns a high similarity score if found.</span>
<span class="sd">    2. Checks for missing characters and returns a high similarity score if found.</span>
<span class="sd">    3. Calculates the similarity based on the number of common characters between the query and the area.</span>
<span class="sd">    4. Returns the similarity score.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">query_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
    <span class="n">area_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">area</span><span class="p">)</span>

    <span class="c1"># Check for exact match</span>
    <span class="k">if</span> <span class="n">query</span> <span class="o">==</span> <span class="n">area</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">100</span>

    <span class="c1"># Check for missing characters</span>
    <span class="k">if</span> <span class="n">query_len</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">area_len</span> <span class="ow">and</span> <span class="n">area</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">90</span>

    <span class="c1"># Check for misspelled names with 1 missing character</span>
    <span class="k">if</span> <span class="n">query_len</span> <span class="o">==</span> <span class="n">area_len</span> <span class="o">+</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">query</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">area</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">90</span>

    <span class="c1"># Calculate similarity based on common characters</span>
    <span class="n">common_chars</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">area</span><span class="p">)</span>
    <span class="n">similarity</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">common_chars</span><span class="p">)</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="n">query_len</span><span class="p">,</span> <span class="n">area_len</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="k">return</span> <span class="n">similarity</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.utils.cap_cars_per_household" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cap_cars_per_household</span><span class="p">(</span><span class="n">households</span><span class="p">,</span> <span class="n">max_cars</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Cap the number of cars per household to a specified maximum.</p>
<p>This function ensures that no household has more than the specified maximum number of cars.
If a household has more cars than the specified maximum, the excess cars are removed and
the car ownership status of individuals is updated accordingly.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>households</code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of Household instances.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_cars</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum number of cars allowed per household. Defaults to 4.</p>
              </div>
            </td>
            <td>
                  <code>4</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>The function performs the following steps:
1. Iterates through each household in the list.
2. Checks if the household has more cars than the specified maximum.
3. If so, removes the excess cars and updates the car ownership status of individuals.</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cap_cars_per_household</span><span class="p">(</span><span class="n">households</span><span class="p">,</span> <span class="n">max_cars</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cap the number of cars per household to a specified maximum.</span>

<span class="sd">    This function ensures that no household has more than the specified maximum number of cars.</span>
<span class="sd">    If a household has more cars than the specified maximum, the excess cars are removed and</span>
<span class="sd">    the car ownership status of individuals is updated accordingly.</span>

<span class="sd">    Args:</span>
<span class="sd">        households (list): The list of Household instances.</span>
<span class="sd">        max_cars (int): The maximum number of cars allowed per household. Defaults to 4.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    The function performs the following steps:</span>
<span class="sd">    1. Iterates through each household in the list.</span>
<span class="sd">    2. Checks if the household has more cars than the specified maximum.</span>
<span class="sd">    3. If so, removes the excess cars and updates the car ownership status of individuals.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">household</span> <span class="ow">in</span> <span class="n">households</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">household</span><span class="o">.</span><span class="n">cars</span> <span class="o">&gt;</span> <span class="n">max_cars</span><span class="p">:</span>
            <span class="n">excess_cars</span> <span class="o">=</span> <span class="n">household</span><span class="o">.</span><span class="n">cars</span> <span class="o">-</span> <span class="n">max_cars</span>
            <span class="n">household</span><span class="o">.</span><span class="n">cars</span> <span class="o">-=</span> <span class="n">excess_cars</span>
            <span class="n">members_with_cars</span> <span class="o">=</span> <span class="p">[</span><span class="n">member</span> <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">household</span><span class="o">.</span><span class="n">members</span> <span class="k">if</span> <span class="n">member</span><span class="o">.</span><span class="n">has_car</span><span class="p">]</span>
            <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">members_with_cars</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">members_with_cars</span><span class="p">[:</span><span class="n">excess_cars</span><span class="p">]:</span>
                <span class="n">person</span><span class="o">.</span><span class="n">has_car</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.utils.clear_instances" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">clear_instances</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Clear all instances of Population, Person, House, Household, Building, and ActivitySequence.</p>
<p>This function clears all instances of the specified classes to reset the data.
It ensures that no residual data remains from previous runs.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>The function performs the following steps:
1. Clears all instances of the Population class.
2. Clears all instances of the Person class.
3. Clears all instances of the House class.
4. Clears all instances of the Household class.
5. Clears all instances of the Building class.
6. Clears all instances of the ActivitySequence class.</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">clear_instances</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clear all instances of Population, Person, House, Household, Building, and ActivitySequence.</span>

<span class="sd">    This function clears all instances of the specified classes to reset the data.</span>
<span class="sd">    It ensures that no residual data remains from previous runs.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    The function performs the following steps:</span>
<span class="sd">    1. Clears all instances of the Population class.</span>
<span class="sd">    2. Clears all instances of the Person class.</span>
<span class="sd">    3. Clears all instances of the House class.</span>
<span class="sd">    4. Clears all instances of the Household class.</span>
<span class="sd">    5. Clears all instances of the Building class.</span>
<span class="sd">    6. Clears all instances of the ActivitySequence class.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Population</span><span class="o">.</span><span class="n">clear_instances</span><span class="p">()</span>
    <span class="n">Person</span><span class="o">.</span><span class="n">clear_instances</span><span class="p">()</span>
    <span class="n">House</span><span class="o">.</span><span class="n">clear_instances</span><span class="p">()</span>
    <span class="n">Household</span><span class="o">.</span><span class="n">clear_instances</span><span class="p">()</span>
    <span class="n">Building</span><span class="o">.</span><span class="n">clear_instances</span><span class="p">()</span>
    <span class="n">ActivitySequence</span><span class="o">.</span><span class="n">clear_instances</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.utils.couples_from_individuals" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">couples_from_individuals</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Create couples from two lists of individuals and form households.</p>
<p>This function matches individuals from two lists (e.g., males and females) to create couples
and form households. It balances the lists, matches individuals based on age, and creates
Household instances for each couple.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>p1</code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The first list of individuals (e.g., males).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>p2</code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The second list of individuals (e.g., females).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the number of households created and the list of Household instances.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>The function performs the following steps:
1. Balances the lengths of the two lists.
2. Matches individuals from the two lists based on age and other criteria.
3. Creates Household instances for each matched couple.
4. Returns the number of households created and the list of Household instances.</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">couples_from_individuals</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create couples from two lists of individuals and form households.</span>

<span class="sd">    This function matches individuals from two lists (e.g., males and females) to create couples</span>
<span class="sd">    and form households. It balances the lists, matches individuals based on age, and creates</span>
<span class="sd">    Household instances for each couple.</span>

<span class="sd">    Args:</span>
<span class="sd">        p1 (list): The first list of individuals (e.g., males).</span>
<span class="sd">        p2 (list): The second list of individuals (e.g., females).</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing the number of households created and the list of Household instances.</span>

<span class="sd">    The function performs the following steps:</span>
<span class="sd">    1. Balances the lengths of the two lists.</span>
<span class="sd">    2. Matches individuals from the two lists based on age and other criteria.</span>
<span class="sd">    3. Creates Household instances for each matched couple.</span>
<span class="sd">    4. Returns the number of households created and the list of Household instances.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">households</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1">#logger.info(f&quot;There are {len(p1)} males and {len(p2)} females in this group&quot;)</span>
    <span class="c1"># Check the length of the two groups, if they are not equal, move the extra individual into a new group</span>
    <span class="c1">#unmatched_individuals = []</span>
    <span class="c1">#logger.info(&quot;Length of partner lists&quot;,len(p1), len(p2))</span>

    <span class="c1"># P1 and p2 need to be of equal length</span>
    <span class="c1"># if moving extra individual to either p1 or p2 makes them equal, then do that</span>
    <span class="c1"># else move the extra individual to unmatched_individuals until the length of p1 and p2 are equal</span>
    <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">unmatched_individuals</span> <span class="o">=</span> <span class="n">balance_lists</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>

    <span class="c1"># Check if unmatched_individuals in empty</span>
    <span class="c1"># if not empty check if it is odd</span>
    <span class="c1"># if odd, create one new person with the same attributes as a random unmatched_individual</span>
    <span class="c1"># and add it to the unmatched_individuals list</span>
    <span class="c1"># Once even, split the list into two and add them to p1 and p2</span>
    <span class="k">if</span> <span class="n">unmatched_individuals</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unmatched_individuals</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># pick a random person</span>
            <span class="n">person</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">unmatched_individuals</span><span class="p">)</span>
            <span class="c1">#get age group of person</span>
            <span class="n">person_age_group</span> <span class="o">=</span> <span class="n">age_group_from_age</span><span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">age</span><span class="p">)</span>
            <span class="n">new_person</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="n">person_age_group</span><span class="p">,</span> <span class="n">person</span><span class="o">.</span><span class="n">sex</span><span class="p">,</span> <span class="n">person</span><span class="o">.</span><span class="n">household_type</span><span class="p">)</span>
            <span class="c1"># Add the new person to the unmatched_individuals list</span>
            <span class="n">unmatched_individuals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_person</span><span class="p">)</span>
        <span class="c1"># Split the unmatched_individuals list into two and add them to p1 and p2</span>
        <span class="n">p1</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">unmatched_individuals</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">unmatched_individuals</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">p2</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">unmatched_individuals</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">unmatched_individuals</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">:])</span>

    <span class="c1">#logger.info(&quot;Length of partner lists&quot;,len(p1), len(p2))</span>
    <span class="c1"># sort the two groups by age</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">age</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">age</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Get the age proxy for group 1</span>
    <span class="n">age_proxy_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">p1</span><span class="p">:</span>
        <span class="c1"># Sample a number from distribution mean = 0 sd = 6</span>
        <span class="n">age_proxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="n">person</span><span class="o">.</span><span class="n">age</span>
        <span class="n">age_proxy_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">age_proxy</span><span class="p">)</span>
    <span class="c1"># sort age_proxy_list in descending order and use it to sort p1</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">age_proxy_list</span><span class="p">,</span> <span class="n">p1</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span>

    <span class="c1"># Match individuals in married_individuals_split_1 with individuals in p2</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">person</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">p1</span><span class="p">):</span>
        <span class="c1"># assiging household head</span>
        <span class="k">if</span> <span class="n">person</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;</span> <span class="n">p2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">age</span><span class="p">:</span>
            <span class="n">person</span><span class="o">.</span><span class="n">is_head</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">is_head</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">household</span> <span class="o">=</span> <span class="n">Household</span><span class="p">(</span><span class="s1">&#39;Couple&#39;</span><span class="p">)</span>
        <span class="n">household</span><span class="o">.</span><span class="n">add_member</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
        <span class="n">household</span><span class="o">.</span><span class="n">add_member</span><span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="c1"># adding household to households</span>
        <span class="n">households</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">household</span><span class="p">)</span>
    <span class="n">households_created</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">households_created</span><span class="p">,</span> <span class="n">households</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.utils.get_older_child_probability_matrix" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_older_child_probability_matrix</span><span class="p">(</span><span class="n">older_children_data</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Calculate the probability matrix for households with older children (aged 25+ years).</p>
<p>This function processes the input data to calculate the probability of households having older children.
It returns a dictionary with the probability of having older children in different household categories.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>older_children_data</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input data containing information on households with older children.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing the probability matrix for households with older children.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>The function performs the following steps:
1. Processes the input data to extract household categories and the count of older children.
2. Calculates the total number of households with older children.
3. Calculates the probability of having older children in each household category.
4. Returns the resulting probability matrix.</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_older_child_probability_matrix</span><span class="p">(</span><span class="n">older_children_data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the probability matrix for households with older children (aged 25+ years).</span>

<span class="sd">    This function processes the input data to calculate the probability of households having older children.</span>
<span class="sd">    It returns a dictionary with the probability of having older children in different household categories.</span>

<span class="sd">    Args:</span>
<span class="sd">        older_children_data (dict): The input data containing information on households with older children.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary containing the probability matrix for households with older children.</span>

<span class="sd">    The function performs the following steps:</span>
<span class="sd">    1. Processes the input data to extract household categories and the count of older children.</span>
<span class="sd">    2. Calculates the total number of households with older children.</span>
<span class="sd">    3. Calculates the probability of having older children in each household category.</span>
<span class="sd">    4. Returns the resulting probability matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">total_older_kids</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">probabilities</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">household_type</span> <span class="ow">in</span> <span class="n">older_children_data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">household_type</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;25&quot;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;Ensamstående&quot;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;Single&quot;</span>
            <span class="k">elif</span> <span class="s2">&quot;Sammanboende&quot;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;Couple&quot;</span>
            <span class="k">elif</span> <span class="s2">&quot;Övriga&quot;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;Other&quot;</span>
            <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

            <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">household_type</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">total_older_kids</span> <span class="o">+=</span> <span class="n">value</span>
            <span class="n">probabilities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="n">probabilities</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span> <span class="o">/</span> <span class="n">total_older_kids</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">probabilities</span><span class="p">]</span>
    <span class="c1"># create a dict of keys and probabilities</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">probabilities</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.utils.get_probability_of_children" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_probability_of_children</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">area</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Calculate the probability of having children in different household types.</p>
<p>This function fetches data on households with children for the specified year and area,
processes the data to calculate the probability of having children in different household types,
and returns the calculated probabilities.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>year</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The year for which the data is to be fetched.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>area</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The geographical area for which the data is to be fetched.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing the probability of having children in each household type.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>The function performs the following steps:
1. Fetches data on households with children for the specified year and area.
2. Processes the data to calculate the total number of households in each household type.
3. Calculates the probability of having children in each household type based on the fetched data.
4. Returns the calculated probabilities.</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_probability_of_children</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">area</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the probability of having children in different household types.</span>

<span class="sd">    This function fetches data on households with children for the specified year and area,</span>
<span class="sd">    processes the data to calculate the probability of having children in different household types,</span>
<span class="sd">    and returns the calculated probabilities.</span>

<span class="sd">    Args:</span>
<span class="sd">        year (int): The year for which the data is to be fetched.</span>
<span class="sd">        area (str): The geographical area for which the data is to be fetched.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary containing the probability of having children in each household type.</span>

<span class="sd">    The function performs the following steps:</span>
<span class="sd">    1. Fetches data on households with children for the specified year and area.</span>
<span class="sd">    2. Processes the data to calculate the total number of households in each household type.</span>
<span class="sd">    3. Calculates the probability of having children in each household type based on the fetched data.</span>
<span class="sd">    4. Returns the calculated probabilities.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">fetch_older_children_data</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">area</span><span class="p">)</span>
    <span class="n">p_children_age</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">nested_key</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;utan barn&#39;</span> <span class="ow">in</span> <span class="n">nested_key</span><span class="p">:</span>
            <span class="n">nested_key</span> <span class="o">=</span> <span class="s1">&#39;No Kids&#39;</span>
        <span class="k">elif</span> <span class="s1">&#39;0-24&#39;</span> <span class="ow">in</span> <span class="n">nested_key</span><span class="p">:</span>
            <span class="n">nested_key</span> <span class="o">=</span> <span class="s1">&#39;Kids Under 25&#39;</span>
        <span class="k">elif</span> <span class="s1">&#39;25&#39;</span> <span class="ow">in</span> <span class="n">nested_key</span><span class="p">:</span>
            <span class="n">nested_key</span> <span class="o">=</span> <span class="s1">&#39;Kids Over 25&#39;</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p_children_age</span><span class="p">:</span>
            <span class="n">p_children_age</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">p_children_age</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">nested_key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="c1"># Total households in each key</span>
    <span class="n">total_households</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">p_children_age</span><span class="p">:</span>
        <span class="n">total_households</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">p_children_age</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="c1"># Replace Ensamstående with Single, Sammanboende with Couple and Övrigt with Other</span>
    <span class="n">total_households</span><span class="p">[</span><span class="s1">&#39;Single&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_households</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Ensamstående&#39;</span><span class="p">)</span>
    <span class="n">total_households</span><span class="p">[</span><span class="s1">&#39;Couple&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_households</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Sammanboende&#39;</span><span class="p">)</span>
    <span class="n">total_households</span><span class="p">[</span><span class="s1">&#39;Other&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_households</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Övriga&#39;</span><span class="p">)</span>

    <span class="c1"># Create a new dictionary called hasChild with two keys True and False and the values are the number of households</span>
    <span class="n">hasChild</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">p_children_age</span><span class="p">:</span>
        <span class="n">hasChild</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">hasChild</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="kc">True</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_children_age</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;Kids Under 25&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">p_children_age</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;Kids Over 25&#39;</span><span class="p">]</span>
        <span class="n">hasChild</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="kc">False</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_children_age</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;No Kids&#39;</span><span class="p">]</span>

    <span class="c1"># Replace Ensamstående with Single, Sammanboende with Couple and Övrigt with Other</span>
    <span class="n">hasChild</span><span class="p">[</span><span class="s1">&#39;Single&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hasChild</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Ensamstående&#39;</span><span class="p">)</span>
    <span class="n">hasChild</span><span class="p">[</span><span class="s1">&#39;Couple&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hasChild</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Sammanboende&#39;</span><span class="p">)</span>
    <span class="n">hasChild</span><span class="p">[</span><span class="s1">&#39;Other&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hasChild</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Övriga&#39;</span><span class="p">)</span>

    <span class="c1"># Calculate the probability of having children in each household type</span>
    <span class="n">p_children</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">hasChild</span><span class="p">:</span>
        <span class="n">p_children</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">p_children</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="kc">True</span><span class="p">]</span> <span class="o">=</span> <span class="n">hasChild</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="kc">True</span><span class="p">]</span><span class="o">/</span><span class="n">total_households</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">p_children</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="kc">False</span><span class="p">]</span> <span class="o">=</span> <span class="n">hasChild</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="kc">False</span><span class="p">]</span><span class="o">/</span><span class="n">total_households</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">p_children</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.utils.get_probability_of_housetype" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_probability_of_housetype</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">area</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Calculate the probability of different household types in a given area.</p>
<p>This function fetches data on household types for the specified year and area,
processes the data to calculate the probability of each household type,
and returns the calculated probabilities.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>year</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The year for which the data is to be fetched.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>area</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The geographical area for which the data is to be fetched.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing the probability of each household type in the area.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>The function performs the following steps:
1. Fetches data on household types for the specified year and area.
2. Processes the data to map household types to simplified categories.
3. Calculates the total number of households in each category.
4. Calculates the percentage of each household type based on the fetched data.
5. Returns the calculated probabilities.</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_probability_of_housetype</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">area</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the probability of different household types in a given area.</span>

<span class="sd">    This function fetches data on household types for the specified year and area,</span>
<span class="sd">    processes the data to calculate the probability of each household type,</span>
<span class="sd">    and returns the calculated probabilities.</span>

<span class="sd">    Args:</span>
<span class="sd">        year (int): The year for which the data is to be fetched.</span>
<span class="sd">        area (str): The geographical area for which the data is to be fetched.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary containing the probability of each household type in the area.</span>

<span class="sd">    The function performs the following steps:</span>
<span class="sd">    1. Fetches data on household types for the specified year and area.</span>
<span class="sd">    2. Processes the data to map household types to simplified categories.</span>
<span class="sd">    3. Calculates the total number of households in each category.</span>
<span class="sd">    4. Calculates the percentage of each household type based on the fetched data.</span>
<span class="sd">    5. Returns the calculated probabilities.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Fetch the data</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">fetch_housetype_data</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">area</span><span class="p">)</span>

    <span class="c1"># Create a dictionary with the probability of each household type</span>
    <span class="n">p_housetype</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">nested_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;Småhus&quot;</span> <span class="ow">in</span> <span class="n">nested_key</span><span class="p">:</span>
            <span class="n">nested_key</span> <span class="o">=</span> <span class="s2">&quot;Villa&quot;</span>
        <span class="k">elif</span> <span class="s2">&quot;Flerbostadshus&quot;</span> <span class="ow">in</span> <span class="n">nested_key</span><span class="p">:</span>
            <span class="n">nested_key</span> <span class="o">=</span> <span class="s2">&quot;Apartment&quot;</span>
        <span class="k">elif</span> <span class="s2">&quot;Specialbostad, övriga hus&quot;</span> <span class="ow">in</span> <span class="n">nested_key</span><span class="p">:</span>
            <span class="n">nested_key</span> <span class="o">=</span> <span class="s2">&quot;Other&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nested_key</span> <span class="o">=</span> <span class="s2">&quot;Not Available&quot;</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p_housetype</span><span class="p">:</span>
            <span class="n">p_housetype</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">p_housetype</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">nested_key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="c1"># Total households in each key</span>
    <span class="n">total_households</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">p_housetype</span><span class="p">:</span>
        <span class="n">total_households</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">p_housetype</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="c1"># Calculate the percentage of each household type</span>
    <span class="n">p_housetype_percentage</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">p_housetype</span><span class="p">:</span>
        <span class="n">p_housetype_percentage</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">nested_key</span> <span class="ow">in</span> <span class="n">p_housetype</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
            <span class="c1"># Take care of divbyzero error</span>
            <span class="k">if</span> <span class="n">total_households</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">p_housetype_percentage</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">nested_key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p_housetype_percentage</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">nested_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_housetype</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">nested_key</span><span class="p">]</span><span class="o">/</span><span class="n">total_households</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">p_housetype_percentage</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.utils.get_younger_child_probability_matrix" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_younger_child_probability_matrix</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Calculate the probability matrix for the number of younger children in households.</p>
<p>This function processes the input data to calculate the probability of having a certain number
of younger children in different household categories. It returns the resulting probability matrix.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input data containing household information.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing the probability matrix for the number of younger children in households.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>The function performs the following steps:
1. Renames household types in the input data to simplified categories.
2. Merges data for similar household types.
3. Creates a nested dictionary with the count of younger children for each household category.
4. Calculates the probability of having a certain number of younger children in each household category.
5. Returns the resulting probability matrix.</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_younger_child_probability_matrix</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the probability matrix for the number of younger children in households.</span>

<span class="sd">    This function processes the input data to calculate the probability of having a certain number</span>
<span class="sd">    of younger children in different household categories. It returns the resulting probability matrix.</span>

<span class="sd">    Args:</span>
<span class="sd">        data (dict): The input data containing household information.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary containing the probability matrix for the number of younger children in households.</span>

<span class="sd">    The function performs the following steps:</span>
<span class="sd">    1. Renames household types in the input data to simplified categories.</span>
<span class="sd">    2. Merges data for similar household types.</span>
<span class="sd">    3. Creates a nested dictionary with the count of younger children for each household category.</span>
<span class="sd">    4. Calculates the probability of having a certain number of younger children in each household category.</span>
<span class="sd">    5. Returns the resulting probability matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Step 1: Rename household types</span>
    <span class="c1"># Create a dictionary to map the original household types to their replacements</span>
    <span class="n">household_types</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Ensamstående&#39;</span><span class="p">:</span> <span class="s1">&#39;Single&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Sammanboende&#39;</span><span class="p">:</span> <span class="s1">&#39;Couple&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Övriga hushåll&#39;</span><span class="p">:</span> <span class="s1">&#39;Couple&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Uppgift saknas&#39;</span><span class="p">:</span> <span class="s1">&#39;Other&#39;</span>
    <span class="p">}</span>

    <span class="c1"># Iterate through each entry in the data</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]:</span>
        <span class="n">household_type</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Get the household type from the entry</span>
        <span class="c1"># Replace the household type with its corresponding replacement if it exists in the dictionary</span>
        <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">household_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">household_type</span><span class="p">,</span> <span class="n">household_type</span><span class="p">)</span>

    <span class="c1"># Step 2: Merge couple households</span>
    <span class="c1"># Initialize an empty dictionary to store the merged data</span>
    <span class="n">merged_data</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Iterate through each entry in the data</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># Extract the key by excluding the area and year</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># Convert the value to an integer</span>
        <span class="n">merged_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">value</span>
        <span class="c1"># Add the value to the existing value for the corresponding key, or initialize it to 0 if the key doesn&#39;t exist</span>

    <span class="c1"># Step 2.1 Nest data</span>
    <span class="c1"># Initialize an empty dictionary to store the nested data</span>
    <span class="n">probability_matrix</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Iterate through each (category, children) pair and its corresponding value in the merged data</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">children</span><span class="p">),</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">merged_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># Create a nested dictionary if the category doesn&#39;t exist in the probability matrix</span>
        <span class="n">probability_matrix</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="p">{})[</span><span class="n">children</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="c1"># Add the value to the corresponding children key in the category dictionary</span>

    <span class="c1"># Step 3: Find totals per children number</span>
    <span class="c1"># Iterate through each household type in the probability matrix</span>
    <span class="k">for</span> <span class="n">household_type</span> <span class="ow">in</span> <span class="n">probability_matrix</span><span class="p">:</span>
        <span class="c1"># Calculate the total value by summing the values for all children numbers in the household type dictionary</span>
        <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">probability_matrix</span><span class="p">[</span><span class="n">household_type</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

        <span class="c1"># Replace the values in the household type dictionary with their respective probabilities</span>
        <span class="n">probability_matrix</span><span class="p">[</span><span class="n">household_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">children</span><span class="p">:</span> <span class="n">value</span> <span class="o">/</span> <span class="n">total</span> <span class="k">if</span> <span class="n">total</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">children</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">probability_matrix</span><span class="p">[</span><span class="n">household_type</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="c1"># Divide each value by the total, accounting for the possibility of zero division</span>
        <span class="p">}</span>

    <span class="c1"># Return the resulting probability matrix</span>
    <span class="k">return</span> <span class="n">probability_matrix</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.utils.impute_municipal_children_count" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">impute_municipal_children_count</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">area</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Impute the count of children in households within a municipality based on provided data.</p>
<p>This function fetches municipal children data for the specified year and area,
processes the data to impute the count of children in different household categories,
and returns the imputed data as dictionaries for households with children aged 0-24 years
and 25 years or older.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>year</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The year for which the data is to be fetched.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>area</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The geographical area for which the data is to be fetched.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Two dictionaries containing imputed children counts for households with children
   aged 0-24 years and 25 years or older.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>The function performs the following steps:
1. Fetches municipal children data for the specified year and area.
2. Processes the data to create a nested dictionary with children counts for different household categories.
3. Transforms the data to calculate the probability of having a certain number of children in each household category.
4. Separates the data into two dictionaries based on the age of children (0-24 years and 25 years or older).
5. Returns the two dictionaries with imputed children counts.</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">impute_municipal_children_count</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">area</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Impute the count of children in households within a municipality based on provided data.</span>

<span class="sd">    This function fetches municipal children data for the specified year and area,</span>
<span class="sd">    processes the data to impute the count of children in different household categories,</span>
<span class="sd">    and returns the imputed data as dictionaries for households with children aged 0-24 years</span>
<span class="sd">    and 25 years or older.</span>

<span class="sd">    Args:</span>
<span class="sd">        year (int): The year for which the data is to be fetched.</span>
<span class="sd">        area (str): The geographical area for which the data is to be fetched.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: Two dictionaries containing imputed children counts for households with children</span>
<span class="sd">               aged 0-24 years and 25 years or older.</span>

<span class="sd">    The function performs the following steps:</span>
<span class="sd">    1. Fetches municipal children data for the specified year and area.</span>
<span class="sd">    2. Processes the data to create a nested dictionary with children counts for different household categories.</span>
<span class="sd">    3. Transforms the data to calculate the probability of having a certain number of children in each household category.</span>
<span class="sd">    4. Separates the data into two dictionaries based on the age of children (0-24 years and 25 years or older).</span>
<span class="sd">    5. Returns the two dictionaries with imputed children counts.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">fetch_municipal_children_data</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>

    <span class="c1"># Extract the relevant data from the JSON</span>
    <span class="n">nested_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">total_households</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">hh</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">hh</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">nested_key</span> <span class="o">=</span> <span class="n">hh</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hh</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1">#total_households.append(value)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nested_dict</span><span class="p">:</span>
            <span class="n">nested_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">nested_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">nested_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">if</span> <span class="s1">&#39;SAKNAS&#39;</span> <span class="ow">in</span> <span class="n">nested_dict</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">nested_dict</span><span class="p">[</span><span class="s1">&#39;SAKNAS&#39;</span><span class="p">]</span>

    <span class="c1"># Calculate the total number of households in the municipality</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">nested_dict</span><span class="p">:</span>
        <span class="n">total_households</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">nested_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

    <span class="c1"># Get probability of number of children in each household category</span>
    <span class="c1">#for i,key in enumerate(nested_dict):</span>
    <span class="c1">#    for nested_key in nested_dict[key]:</span>
    <span class="c1">#        nested_dict[key][nested_key] = nested_dict[key][nested_key]/total_households[i]</span>

    <span class="c1"># Creating a dictionary for name changes</span>
    <span class="n">name_change</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;ESUB&#39;</span><span class="p">:</span> <span class="s1">&#39;Ensamstående utan barn&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ESMB24&#39;</span><span class="p">:</span> <span class="s1">&#39;Ensamstående med barn 0-24 år&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ESMB25&#39;</span><span class="p">:</span> <span class="s1">&#39;Ensamstående med barn 25 år eller äldre&#39;</span><span class="p">,</span>
        <span class="s1">&#39;SMUB&#39;</span><span class="p">:</span> <span class="s1">&#39;Sammanboende utan barn&#39;</span><span class="p">,</span>
        <span class="s1">&#39;SBMB24&#39;</span><span class="p">:</span> <span class="s1">&#39;Sammanboende med barn 0-24 år&#39;</span><span class="p">,</span>
        <span class="s1">&#39;SBMB25&#39;</span><span class="p">:</span> <span class="s1">&#39;Sammanboende med barn 25 år eller äldre&#39;</span><span class="p">,</span>
        <span class="s1">&#39;OVRIUB&#39;</span><span class="p">:</span> <span class="s1">&#39;Övriga hushåll utan barn&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ÖMB24&#39;</span><span class="p">:</span> <span class="s1">&#39;Övriga hushåll med barn 0-24 år&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ÖMB25&#39;</span><span class="p">:</span> <span class="s1">&#39;Övriga hushåll med barn 25 år eller äldre&#39;</span>
    <span class="p">}</span>

    <span class="c1"># If a key is found in the name_change dictionary, replace the key with the value</span>
    <span class="n">municipal_children</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">old_key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">nested_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">new_key</span> <span class="o">=</span> <span class="n">name_change</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">old_key</span><span class="p">,</span> <span class="n">old_key</span><span class="p">)</span>
        <span class="n">municipal_children</span><span class="p">[</span><span class="n">new_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="c1"># Remove keys with utan barn</span>
    <span class="n">municipal_children</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">municipal_children</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;utan barn&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">k</span><span class="p">}</span>

    <span class="c1"># Replace UB with 0, M1B with 1, M2B with 2, M3+B with 3</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">municipal_children</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">key_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="c1"># Check if any [&#39;UB&#39;,&#39;M1B&#39;, &#39;M2B&#39;,&#39;M3+B&#39;,&#39;SAKNAS&#39;] in key_list</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">key_list</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;UB&#39;</span><span class="p">,</span><span class="s1">&#39;M1B&#39;</span><span class="p">,</span> <span class="s1">&#39;M2B&#39;</span><span class="p">,</span><span class="s1">&#39;M3+B&#39;</span><span class="p">,</span><span class="s1">&#39;SAKNAS&#39;</span><span class="p">]):</span>
            <span class="n">municipal_children</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">municipal_children</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;UB&#39;</span><span class="p">)</span>
            <span class="n">municipal_children</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">municipal_children</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;M1B&#39;</span><span class="p">)</span>
            <span class="n">municipal_children</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">municipal_children</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;M2B&#39;</span><span class="p">)</span>
            <span class="n">municipal_children</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">municipal_children</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;M3+B&#39;</span><span class="p">)</span>
            <span class="n">municipal_children</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;other&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">municipal_children</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;SAKNAS&#39;</span><span class="p">)</span>


    <span class="c1"># Create two dicts from municipal_children dict, one for 0-24 years and one for 25+ years</span>
    <span class="n">municipal_children_0_24</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">municipal_children</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;0-24&#39;</span> <span class="ow">in</span> <span class="n">k</span><span class="p">}</span>
    <span class="n">municipal_children_25</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">municipal_children</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;25&#39;</span> <span class="ow">in</span> <span class="n">k</span><span class="p">}</span>

    <span class="c1"># split key and replace with first word</span>
    <span class="n">municipal_children_0_24</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">municipal_children_0_24</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="n">municipal_children_25</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">municipal_children_25</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="c1"># Replace ensamstående with single, sammanboende with couple and övriga hushåll with other</span>
    <span class="n">municipal_children_0_24</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Ensamstående&#39;</span><span class="p">,</span> <span class="s1">&#39;Single&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Sammanboende&#39;</span><span class="p">,</span> <span class="s1">&#39;Couple&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Övriga&#39;</span><span class="p">,</span> <span class="s1">&#39;Other&#39;</span><span class="p">):</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">municipal_children_0_24</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="n">municipal_children_25</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Ensamstående&#39;</span><span class="p">,</span> <span class="s1">&#39;Single&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Sammanboende&#39;</span><span class="p">,</span> <span class="s1">&#39;Couple&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Övriga&#39;</span><span class="p">,</span> <span class="s1">&#39;Other&#39;</span><span class="p">):</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">municipal_children_25</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="c1"># Calculate total households 0-24 and 25+</span>
    <span class="n">total_households_0_24</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">total_households_25</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">municipal_children_0_24</span><span class="p">:</span>
        <span class="n">total_households_0_24</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">municipal_children_0_24</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">municipal_children_25</span><span class="p">:</span>
        <span class="n">total_households_25</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">municipal_children_25</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>


    <span class="c1"># Calculate the probability of number of children in each household category</span>
    <span class="n">municipal_children_0_24</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">municipal_children_0_24</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">hh</span> <span class="ow">in</span> <span class="n">municipal_children_0_24</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
            <span class="n">municipal_children_0_24</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">hh</span><span class="p">]</span> <span class="o">=</span> <span class="n">municipal_children_0_24</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">hh</span><span class="p">]</span><span class="o">/</span><span class="n">total_households_0_24</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">municipal_children_25</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">hh</span> <span class="ow">in</span> <span class="n">municipal_children_25</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
            <span class="n">municipal_children_25</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">hh</span><span class="p">]</span> <span class="o">=</span> <span class="n">municipal_children_25</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">hh</span><span class="p">]</span><span class="o">/</span><span class="n">total_households_25</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">municipal_children_0_24</span><span class="p">,</span> <span class="n">municipal_children_25</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.utils.match_child_to_parent" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">match_child_to_parent</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">list_of_children</span><span class="p">,</span> <span class="n">min_age_of_parent</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">initial_tolerance</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_tolerance</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">tolerance_increment</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Match a child to a parent based on age and add the child to the parent's household.</p>
<p>This function matches a child to a parent from the list of children based on the age difference
between the parent and the child. It uses a tolerance range to find a suitable match and adds
the matched child to the parent's household.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>parent</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tripsender.person.Person" href="../person/#tripsender.person.Person">Person</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The parent individual.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>list_of_children</code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of child individuals to match.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>min_age_of_parent</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The minimum age for a parent. Defaults to 20.</p>
              </div>
            </td>
            <td>
                  <code>20</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>initial_tolerance</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The initial tolerance range for matching. Defaults to 5.</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_tolerance</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum tolerance range for matching. Defaults to 20.</p>
              </div>
            </td>
            <td>
                  <code>20</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>tolerance_increment</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The increment in tolerance range for each iteration. Defaults to 2.</p>
              </div>
            </td>
            <td>
                  <code>2</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>The function performs the following steps:
1. Calculates the proxy age of the child based on the parent's age and minimum age of parent.
2. Iterates through the list of children to find a match within the initial tolerance range.
3. If no match is found, increases the tolerance range and retries until the maximum tolerance is reached.
4. Adds the matched child to the parent's household and removes the child from the list of children.
5. Logs the matching process and results.</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">match_child_to_parent</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">list_of_children</span><span class="p">,</span> <span class="n">min_age_of_parent</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">initial_tolerance</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_tolerance</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">tolerance_increment</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Match a child to a parent based on age and add the child to the parent&#39;s household.</span>

<span class="sd">    This function matches a child to a parent from the list of children based on the age difference</span>
<span class="sd">    between the parent and the child. It uses a tolerance range to find a suitable match and adds</span>
<span class="sd">    the matched child to the parent&#39;s household.</span>

<span class="sd">    Args:</span>
<span class="sd">        parent (Person): The parent individual.</span>
<span class="sd">        list_of_children (list): The list of child individuals to match.</span>
<span class="sd">        min_age_of_parent (int, optional): The minimum age for a parent. Defaults to 20.</span>
<span class="sd">        initial_tolerance (int, optional): The initial tolerance range for matching. Defaults to 5.</span>
<span class="sd">        max_tolerance (int, optional): The maximum tolerance range for matching. Defaults to 20.</span>
<span class="sd">        tolerance_increment (int, optional): The increment in tolerance range for each iteration. Defaults to 2.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    The function performs the following steps:</span>
<span class="sd">    1. Calculates the proxy age of the child based on the parent&#39;s age and minimum age of parent.</span>
<span class="sd">    2. Iterates through the list of children to find a match within the initial tolerance range.</span>
<span class="sd">    3. If no match is found, increases the tolerance range and retries until the maximum tolerance is reached.</span>
<span class="sd">    4. Adds the matched child to the parent&#39;s household and removes the child from the list of children.</span>
<span class="sd">    5. Logs the matching process and results.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Age difference heuristic based on the parent&#39;s age</span>
    <span class="n">proxy_age_of_child</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">age</span> <span class="o">-</span> <span class="n">min_age_of_parent</span>

    <span class="c1">#logger.info(f&quot;match_child_to_parent: Parent Age: {parent.age}. Calculated Proxy Age of Child: {proxy_age_of_child}.&quot;)</span>

    <span class="n">tolerance</span> <span class="o">=</span> <span class="n">initial_tolerance</span>
    <span class="n">children_to_remove</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">while</span> <span class="n">tolerance</span> <span class="o">&lt;=</span> <span class="n">max_tolerance</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">children_to_remove</span><span class="p">:</span>
        <span class="c1">#logger.info(f&quot;match_child_to_parent: Checking with tolerance: {tolerance} years&quot;)</span>

        <span class="c1"># Get potential matches based on current tolerance</span>
        <span class="n">potential_matches</span> <span class="o">=</span> <span class="p">[</span><span class="n">child</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">list_of_children</span> <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">age</span> <span class="o">-</span> <span class="n">proxy_age_of_child</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tolerance</span><span class="p">]</span>

        <span class="c1"># If there are potential matches, sort them by age (older children first)</span>
        <span class="n">potential_matches</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">age</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">potential_matches</span><span class="p">:</span>
            <span class="c1"># Pick the oldest child from potential matches</span>
            <span class="n">chosen_child</span> <span class="o">=</span> <span class="n">potential_matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1">#logger.info(f&quot;match_child_to_parent: Matched child {chosen_child.age} to parent {parent.age} with tolerance {tolerance} years.&quot;)</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">household</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">chosen_child</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Matched child (age: </span><span class="si">{</span><span class="n">chosen_child</span><span class="o">.</span><span class="n">age</span><span class="si">}</span><span class="s2">) to household with parent (age: </span><span class="si">{</span><span class="n">parent</span><span class="o">.</span><span class="n">age</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            <span class="n">children_to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chosen_child</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tolerance</span> <span class="o">+=</span> <span class="n">tolerance_increment</span>
            <span class="c1">#logger.info(f&quot;match_child_to_parent: No suitable children found for parent {parent.age} of {parent.household_type} with current tolerance. Increasing tolerance.&quot;)</span>

    <span class="c1"># Remove matched children from the list</span>
    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">children_to_remove</span><span class="p">:</span>
        <span class="n">list_of_children</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">children_to_remove</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;match_child_to_parent: No suitable children found for parent </span><span class="si">{</span><span class="n">parent</span><span class="o">.</span><span class="n">age</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="n">parent</span><span class="o">.</span><span class="n">household_type</span><span class="si">}</span><span class="s2"> even with max tolerance of </span><span class="si">{</span><span class="n">max_tolerance</span><span class="si">}</span><span class="s2"> years.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.utils.match_list_household_children" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">match_list_household_children</span><span class="p">(</span><span class="n">list_household</span><span class="p">,</span> <span class="n">list_children</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Match children to households based on the number of children needed.</p>
<p>This function matches children to households based on the number of children each household
needs. It expands the household list based on the number of children required and pairs
each child with a household.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>list_household</code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of households.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>list_children</code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of children to be matched.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>The function performs the following steps:
1. Expands the household list based on the number of children needed in each household.
2. Sorts the household list based on the age of a randomly chosen parent.
3. Sorts the children list by age.
4. Pairs each child with a household and adds the child to the household.
5. Logs the matching process and results.</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">match_list_household_children</span><span class="p">(</span><span class="n">list_household</span><span class="p">,</span> <span class="n">list_children</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Match children to households based on the number of children needed.</span>

<span class="sd">    This function matches children to households based on the number of children each household</span>
<span class="sd">    needs. It expands the household list based on the number of children required and pairs</span>
<span class="sd">    each child with a household.</span>

<span class="sd">    Args:</span>
<span class="sd">        list_household (list): The list of households.</span>
<span class="sd">        list_children (list): The list of children to be matched.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    The function performs the following steps:</span>
<span class="sd">    1. Expands the household list based on the number of children needed in each household.</span>
<span class="sd">    2. Sorts the household list based on the age of a randomly chosen parent.</span>
<span class="sd">    3. Sorts the children list by age.</span>
<span class="sd">    4. Pairs each child with a household and adds the child to the household.</span>
<span class="sd">    5. Logs the matching process and results.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">new_list_household</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Expand household list based on the number of children in each household</span>
    <span class="k">for</span> <span class="n">household</span> <span class="ow">in</span> <span class="n">list_household</span><span class="p">:</span>
        <span class="n">stack_number</span> <span class="o">=</span> <span class="n">household</span><span class="o">.</span><span class="n">children</span>
        <span class="n">temp_household_stack</span> <span class="o">=</span> <span class="p">[</span><span class="n">household</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">stack_number</span><span class="p">)]</span>
        <span class="n">new_list_household</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">temp_household_stack</span><span class="p">)</span>

    <span class="c1"># Sort the household list based on the age of a randomly chosen parent (from oldest to youngest)</span>
    <span class="c1">#new_list_household.sort(key=lambda household: random.choice([member.age for member in household.members if not member.is_child]))</span>

    <span class="c1"># Sort the children list by age (oldest first)</span>
    <span class="n">list_children</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">child</span><span class="p">:</span> <span class="n">child</span><span class="o">.</span><span class="n">age</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Pair each child with a household</span>
    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">list_children</span><span class="p">:</span>
        <span class="n">household</span> <span class="o">=</span> <span class="n">new_list_household</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">parents</span> <span class="o">=</span> <span class="p">[</span><span class="n">member</span> <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">household</span><span class="o">.</span><span class="n">members</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">member</span><span class="o">.</span><span class="n">is_child</span><span class="p">]</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">parents</span><span class="p">)</span>
        <span class="c1">#logger.info(f&quot;Matched child (age: {child.age}) to household with parent (age: {parent.age})&quot;)</span>
        <span class="n">household</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.utils.parse_num_children" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_num_children</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Parse the number of children from a string.</p>
<p>This function extracts the number of children from the given data string using regular expressions.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input string containing the number of children.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>int</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of children extracted from the input string. Returns 0 if no number is found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>parse_num_children("3 children")
3</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>tripsender\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">parse_num_children</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse the number of children from a string.</span>

<span class="sd">    This function extracts the number of children from the given data string using regular expressions.</span>

<span class="sd">    Args:</span>
<span class="sd">        data (str): The input string containing the number of children.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: The number of children extracted from the input string. Returns 0 if no number is found.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; parse_num_children(&quot;3 children&quot;)</span>
<span class="sd">        3</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d+&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">())</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d+&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.utils.preprocess_household_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">preprocess_household_data</span><span class="p">(</span><span class="n">aligned_columns</span><span class="o">=</span><span class="p">[],</span> <span class="n">drop</span><span class="o">=</span><span class="p">[],</span> <span class="n">onehotencode</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Preprocess household data for model input.</p>
<p>This function preprocesses household data by ensuring all required columns are present,
dropping specified columns, and optionally one-hot encoding categorical variables.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>aligned_columns</code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of columns to ensure are present in the DataFrame.</p>
              </div>
            </td>
            <td>
                  <code>[]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>drop</code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of columns to drop from the DataFrame.</p>
              </div>
            </td>
            <td>
                  <code>[]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>onehotencode</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to one-hot encode categorical variables. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the preprocessed DataFrame and the list of adult individuals.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>The function performs the following steps:
1. Fetches household data and adult individuals.
2. Ensures all specified columns are present in the DataFrame.
3. Drops specified columns from the DataFrame.
4. Optionally one-hot encodes categorical variables.
5. Returns the preprocessed DataFrame and the list of adult individuals.</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">preprocess_household_data</span><span class="p">(</span><span class="n">aligned_columns</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">drop</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">onehotencode</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Preprocess household data for model input.</span>

<span class="sd">    This function preprocesses household data by ensuring all required columns are present,</span>
<span class="sd">    dropping specified columns, and optionally one-hot encoding categorical variables.</span>

<span class="sd">    Args:</span>
<span class="sd">        aligned_columns (list): List of columns to ensure are present in the DataFrame.</span>
<span class="sd">        drop (list): List of columns to drop from the DataFrame.</span>
<span class="sd">        onehotencode (bool): Whether to one-hot encode categorical variables. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing the preprocessed DataFrame and the list of adult individuals.</span>

<span class="sd">    The function performs the following steps:</span>
<span class="sd">    1. Fetches household data and adult individuals.</span>
<span class="sd">    2. Ensures all specified columns are present in the DataFrame.</span>
<span class="sd">    3. Drops specified columns from the DataFrame.</span>
<span class="sd">    4. Optionally one-hot encodes categorical variables.</span>
<span class="sd">    5. Returns the preprocessed DataFrame and the list of adult individuals.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">df</span><span class="p">,</span> <span class="n">adults</span> <span class="o">=</span> <span class="n">Household</span><span class="o">.</span><span class="n">return_nhts</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="n">drop</span><span class="p">,</span> <span class="n">onehotencode</span><span class="o">=</span><span class="n">onehotencode</span><span class="p">)</span>

    <span class="c1"># Ensure all columns in aligned_columns are present in the DataFrame</span>
    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">aligned_columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">aligned_columns</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">df</span><span class="p">,</span> <span class="n">adults</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.utils.sample_children_category" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sample_children_category</span><span class="p">(</span><span class="n">probability_matrix</span><span class="p">,</span> <span class="n">household_type</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Sample a children category based on the probability matrix for the given household type.</p>
<p>This function uses the provided probability matrix to randomly sample a children category
for the specified household type.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>probability_matrix</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The probability matrix for children categories.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>household_type</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The household type for which to sample a children category.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>int</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The sampled children category. Returns None if the household type is not found in the probability matrix.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>The function performs the following steps:
1. Checks if the household type exists in the probability matrix.
2. Extracts children categories and their corresponding probabilities from the probability matrix.
3. Randomly samples a children category based on the extracted probabilities.
4. Returns the sampled children category.</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">sample_children_category</span><span class="p">(</span><span class="n">probability_matrix</span><span class="p">,</span> <span class="n">household_type</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sample a children category based on the probability matrix for the given household type.</span>

<span class="sd">    This function uses the provided probability matrix to randomly sample a children category</span>
<span class="sd">    for the specified household type.</span>

<span class="sd">    Args:</span>
<span class="sd">        probability_matrix (dict): The probability matrix for children categories.</span>
<span class="sd">        household_type (str): The household type for which to sample a children category.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: The sampled children category. Returns None if the household type is not found in the probability matrix.</span>

<span class="sd">    The function performs the following steps:</span>
<span class="sd">    1. Checks if the household type exists in the probability matrix.</span>
<span class="sd">    2. Extracts children categories and their corresponding probabilities from the probability matrix.</span>
<span class="sd">    3. Randomly samples a children category based on the extracted probabilities.</span>
<span class="sd">    4. Returns the sampled children category.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">household_type</span> <span class="ow">in</span> <span class="n">probability_matrix</span><span class="p">:</span>
        <span class="n">children_categories</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">probability_matrix</span><span class="p">[</span><span class="n">household_type</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">probabilities</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">probability_matrix</span><span class="p">[</span><span class="n">household_type</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

        <span class="c1"># Sample a children category based on the probabilities</span>
        <span class="n">sampled_category</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">children_categories</span><span class="p">,</span> <span class="n">probabilities</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span><span class="p">(</span><span class="n">sampled_category</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.utils.sample_household_for_older_child" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sample_household_for_older_child</span><span class="p">(</span><span class="n">probability_matrix</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Sample a household type based on the probability matrix for older children.</p>
<p>This function uses the provided probability matrix to randomly sample a household type
that is likely to have older children.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>probability_matrix</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The probability matrix for households with older children.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The sampled household type.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>The function performs the following steps:
1. Extracts household categories and their corresponding probabilities from the probability matrix.
2. Randomly samples a household type based on the extracted probabilities.
3. Returns the sampled household type.</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">sample_household_for_older_child</span><span class="p">(</span><span class="n">probability_matrix</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sample a household type based on the probability matrix for older children.</span>

<span class="sd">    This function uses the provided probability matrix to randomly sample a household type</span>
<span class="sd">    that is likely to have older children.</span>

<span class="sd">    Args:</span>
<span class="sd">        probability_matrix (dict): The probability matrix for households with older children.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The sampled household type.</span>

<span class="sd">    The function performs the following steps:</span>
<span class="sd">    1. Extracts household categories and their corresponding probabilities from the probability matrix.</span>
<span class="sd">    2. Randomly samples a household type based on the extracted probabilities.</span>
<span class="sd">    3. Returns the sampled household type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Sample a household type based on the probabilities</span>
    <span class="n">household_categories</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">probability_matrix</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">probabilities</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">probability_matrix</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">sampled_household_type</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">household_categories</span><span class="p">,</span> <span class="n">probabilities</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span><span class="p">(</span><span class="n">sampled_household_type</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.utils.search_primary_area" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">search_primary_area</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">PATH_PRIMARY_AREA</span><span class="p">))</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Search for the best matching primary area from the DataFrame based on the query.</p>
<p>This function takes a query string and searches for the best matching primary area
from the given DataFrame. It calculates the similarity between the query and each
primary area in the DataFrame, and returns the best match.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>query</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The query string to search for.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>df</code></td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The DataFrame containing primary areas. Defaults to reading from PATH_PRIMARY_AREA.</p>
              </div>
            </td>
            <td>
                  <code><span title="pandas.read_csv">read_csv</span>(<span title="tripsender.utils.PATH_PRIMARY_AREA">PATH_PRIMARY_AREA</span>)</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The best matching primary area.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>The function performs the following steps:
1. Converts the query to lowercase for case-insensitive comparison.
2. Iterates through each primary area in the DataFrame, converting it to lowercase.
3. Calculates the similarity between the query and the current primary area.
4. Updates the best match if the current primary area has a higher similarity score.
5. Returns the best matching primary area.</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span>
<span class="normal">99</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">search_primary_area</span><span class="p">(</span><span class="n">query</span><span class="p">,</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">PATH_PRIMARY_AREA</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Search for the best matching primary area from the DataFrame based on the query.</span>

<span class="sd">    This function takes a query string and searches for the best matching primary area</span>
<span class="sd">    from the given DataFrame. It calculates the similarity between the query and each</span>
<span class="sd">    primary area in the DataFrame, and returns the best match.</span>

<span class="sd">    Args:</span>
<span class="sd">        query (str): The query string to search for.</span>
<span class="sd">        df (pd.DataFrame): The DataFrame containing primary areas. Defaults to reading from PATH_PRIMARY_AREA.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The best matching primary area.</span>

<span class="sd">    The function performs the following steps:</span>
<span class="sd">    1. Converts the query to lowercase for case-insensitive comparison.</span>
<span class="sd">    2. Iterates through each primary area in the DataFrame, converting it to lowercase.</span>
<span class="sd">    3. Calculates the similarity between the query and the current primary area.</span>
<span class="sd">    4. Updates the best match if the current primary area has a higher similarity score.</span>
<span class="sd">    5. Returns the best matching primary area.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>  <span class="c1"># Convert query to lowercase</span>

    <span class="n">best_match</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">best_similarity</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">area</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;primary_area&#39;</span><span class="p">]:</span>
        <span class="n">area_lower</span> <span class="o">=</span> <span class="n">area</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>  <span class="c1"># Convert area to lowercase</span>

        <span class="n">similarity</span> <span class="o">=</span> <span class="n">calculate_similarity</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">area_lower</span><span class="p">)</span>  <span class="c1"># Calculate similarity</span>

        <span class="c1"># Update the best match if the current area has higher similarity</span>
        <span class="k">if</span> <span class="n">similarity</span> <span class="o">&gt;</span> <span class="n">best_similarity</span><span class="p">:</span>
            <span class="n">best_similarity</span> <span class="o">=</span> <span class="n">similarity</span>
            <span class="n">best_match</span> <span class="o">=</span> <span class="n">area</span>

    <span class="k">return</span> <span class="n">best_match</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tripsender.utils.split_households_by_householdtype" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">split_households_by_householdtype</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Split individuals into different lists based on their household type.</p>
<p>This function splits individuals into different lists based on their household type,
such as children, single parents, living alone, married, cohabiting, and others.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing lists of individuals for each household type.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>The function performs the following steps:
1. Iterates through each individual and categorizes them based on their household type.
2. Adds the individuals to the corresponding list for their household type.
3. Logs the number of individuals in each household type.
4. Returns the lists of individuals for each household type.</p>

            <details class="quote">
              <summary>Source code in <code>tripsender\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">split_households_by_householdtype</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Split individuals into different lists based on their household type.</span>

<span class="sd">    This function splits individuals into different lists based on their household type,</span>
<span class="sd">    such as children, single parents, living alone, married, cohabiting, and others.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing lists of individuals for each household type.</span>

<span class="sd">    The function performs the following steps:</span>
<span class="sd">    1. Iterates through each individual and categorizes them based on their household type.</span>
<span class="sd">    2. Adds the individuals to the corresponding list for their household type.</span>
<span class="sd">    3. Logs the number of individuals in each household type.</span>
<span class="sd">    4. Returns the lists of individuals for each household type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create a list of households</span>

    <span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">single_parents</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">living_alone</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">married_males</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">married_females</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cohabiting_males</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cohabiting_females</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">others</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Separate individuals into different lists based on their category</span>
    <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">Person</span><span class="o">.</span><span class="n">instances</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">person</span><span class="o">.</span><span class="n">household_type</span> <span class="o">==</span> <span class="n">CHILD</span><span class="p">:</span>                                  <span class="c1"># Child</span>
            <span class="n">person</span><span class="o">.</span><span class="n">is_child</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">person</span><span class="o">.</span><span class="n">household_type</span> <span class="o">==</span> <span class="n">SINGLE_PARENT</span><span class="p">:</span>                        <span class="c1"># Single parent</span>
            <span class="c1">#person.hasChild = True</span>
            <span class="n">single_parents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">person</span><span class="o">.</span><span class="n">household_type</span> <span class="o">==</span> <span class="n">LIVING_ALONE</span><span class="p">:</span>                         <span class="c1"># Living alone</span>
            <span class="n">living_alone</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">person</span><span class="o">.</span><span class="n">household_type</span> <span class="o">==</span> <span class="n">MARRIED</span><span class="p">:</span>                              <span class="c1"># Married</span>
            <span class="k">if</span> <span class="n">person</span><span class="o">.</span><span class="n">sex</span> <span class="o">==</span> <span class="n">MALE</span><span class="p">:</span>
                <span class="n">married_males</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">married_females</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">person</span><span class="o">.</span><span class="n">household_type</span> <span class="o">==</span> <span class="n">COHABITING</span><span class="p">:</span>                           <span class="c1"># Cohabiting</span>
            <span class="k">if</span> <span class="n">person</span><span class="o">.</span><span class="n">sex</span> <span class="o">==</span> <span class="n">MALE</span><span class="p">:</span>
                <span class="n">cohabiting_males</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cohabiting_females</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">others</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>                                           <span class="c1"># Not living alone/ other</span>

    <span class="c1"># Print the number of individuals in each category</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of children: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">children</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of single parents: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">single_parents</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of individuals living alone: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">living_alone</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of married males: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">married_males</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of married females: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">married_females</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of cohabiting males: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cohabiting_males</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of cohabiting females: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cohabiting_females</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of others: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">others</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">children</span><span class="p">,</span> <span class="n">single_parents</span><span class="p">,</span> <span class="n">living_alone</span><span class="p">,</span> <span class="n">married_males</span><span class="p">,</span> <span class="n">married_females</span><span class="p">,</span> <span class="n">cohabiting_males</span><span class="p">,</span> <span class="n">cohabiting_females</span><span class="p">,</span> <span class="n">others</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
